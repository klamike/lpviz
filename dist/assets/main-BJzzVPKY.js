var Me=Object.defineProperty;var ie=i=>{throw TypeError(i)};var ke=(i,s,e)=>s in i?Me(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var re=(i,s,e)=>ke(i,typeof s!="symbol"?s+"":s,e),Jt=(i,s,e)=>s.has(i)||ie("Cannot "+e);var gt=(i,s,e)=>(Jt(i,s,"read from private field"),e?e.call(i):s.get(i)),Kt=(i,s,e)=>s.has(i)?ie("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(i):s.set(i,e),Dt=(i,s,e,t)=>(Jt(i,s,"write to private field"),t?t.call(i,e):s.set(i,e),e),Qt=(i,s,e)=>(Jt(i,s,"access private method"),e);function pe(i){if(i.__esModule)return i;var s=i.default;if(typeof s=="function"){var e=function t(){return this instanceof t?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};e.prototype=s.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(t){var o=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(e,t,o.get?o:{enumerable:!0,get:function(){return i[t]}})}),e}var U={};const Pe=Object.prototype.toString;function Ct(i){const s=Pe.call(i);return s.endsWith("Array]")&&!s.includes("Big")}const Be=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Ct},Symbol.toStringTag,{value:"Module"})),Te=pe(Be);function Ce(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ct(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var e=s.fromIndex,t=e===void 0?0:e,o=s.toIndex,n=o===void 0?i.length:o;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(n<=t||n>i.length||!Number.isInteger(n))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var r=i[t],l=t+1;l<n;l++)i[l]>r&&(r=i[l]);return r}function _e(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ct(i))throw new TypeError("input must be an array");if(i.length===0)throw new TypeError("input must not be empty");var e=s.fromIndex,t=e===void 0?0:e,o=s.toIndex,n=o===void 0?i.length:o;if(t<0||t>=i.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(n<=t||n>i.length||!Number.isInteger(n))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var r=i[t],l=t+1;l<n;l++)i[l]<r&&(r=i[l]);return r}function Re(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ct(i)){if(i.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(s.output!==void 0){if(!Ct(s.output))throw new TypeError("output option must be an array if specified");e=s.output}else e=new Array(i.length);var t=_e(i),o=Ce(i);if(t===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var n=s.min,r=n===void 0?s.autoMinMax?t:0:n,l=s.max,a=l===void 0?s.autoMinMax?o:1:l;if(r>=a)throw new RangeError("min option must be smaller than max option");for(var h=(a-r)/(o-t),u=0;u<i.length;u++)e[u]=(i[u]-t)*h+r;return e}const De=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"})),Fe=pe(De);Object.defineProperty(U,"__esModule",{value:!0});var lt=Te,le=Fe;const Ft=" ".repeat(2),we=" ".repeat(4);function Ne(){return ye(this)}function ye(i,s={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:o=8,padMinus:n="auto"}=s;return`${i.constructor.name} {
${Ft}[
${we}${Le(i,e,t,o,n)}
${Ft}]
${Ft}rows: ${i.rows}
${Ft}columns: ${i.columns}
}`}function Le(i,s,e,t,o){const{rows:n,columns:r}=i,l=Math.min(n,s),a=Math.min(r,e),h=[];if(o==="auto"){o=!1;t:for(let u=0;u<l;u++)for(let c=0;c<a;c++)if(i.get(u,c)<0){o=!0;break t}}for(let u=0;u<l;u++){let c=[];for(let w=0;w<a;w++)c.push($e(i.get(u,w),t,o));h.push(`${c.join(" ")}`)}return a!==r&&(h[h.length-1]+=` ... ${r-e} more columns`),l!==n&&h.push(`... ${n-s} more rows`),h.join(`
${we}`)}function $e(i,s,e){return(i>=0&&e?` ${ce(i,s-1)}`:ce(i,s)).padEnd(s)}function ce(i,s){let e=i.toString();if(e.length<=s)return e;let t=i.toFixed(s);if(t.length>s&&(t=i.toFixed(Math.max(0,s-(t.length-s)))),t.length<=s&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let o=i.toExponential(s);return o.length>s&&(o=i.toExponential(Math.max(0,s-(o.length-s)))),o.slice(0)}function Ve(i,s){i.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},i.prototype.addS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)+t);return this},i.prototype.addM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)+t.get(o,n));return this},i.add=function(t,o){return new s(t).add(o)},i.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},i.prototype.subS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)-t);return this},i.prototype.subM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)-t.get(o,n));return this},i.sub=function(t,o){return new s(t).sub(o)},i.prototype.subtract=i.prototype.sub,i.prototype.subtractS=i.prototype.subS,i.prototype.subtractM=i.prototype.subM,i.subtract=i.sub,i.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},i.prototype.mulS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)*t);return this},i.prototype.mulM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)*t.get(o,n));return this},i.mul=function(t,o){return new s(t).mul(o)},i.prototype.multiply=i.prototype.mul,i.prototype.multiplyS=i.prototype.mulS,i.prototype.multiplyM=i.prototype.mulM,i.multiply=i.mul,i.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},i.prototype.divS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)/t);return this},i.prototype.divM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)/t.get(o,n));return this},i.div=function(t,o){return new s(t).div(o)},i.prototype.divide=i.prototype.div,i.prototype.divideS=i.prototype.divS,i.prototype.divideM=i.prototype.divM,i.divide=i.div,i.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},i.prototype.modS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)%t);return this},i.prototype.modM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)%t.get(o,n));return this},i.mod=function(t,o){return new s(t).mod(o)},i.prototype.modulus=i.prototype.mod,i.prototype.modulusS=i.prototype.modS,i.prototype.modulusM=i.prototype.modM,i.modulus=i.mod,i.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},i.prototype.andS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)&t);return this},i.prototype.andM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)&t.get(o,n));return this},i.and=function(t,o){return new s(t).and(o)},i.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},i.prototype.orS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)|t);return this},i.prototype.orM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)|t.get(o,n));return this},i.or=function(t,o){return new s(t).or(o)},i.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},i.prototype.xorS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)^t);return this},i.prototype.xorM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)^t.get(o,n));return this},i.xor=function(t,o){return new s(t).xor(o)},i.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},i.prototype.leftShiftS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)<<t);return this},i.prototype.leftShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)<<t.get(o,n));return this},i.leftShift=function(t,o){return new s(t).leftShift(o)},i.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},i.prototype.signPropagatingRightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)>>t);return this},i.prototype.signPropagatingRightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)>>t.get(o,n));return this},i.signPropagatingRightShift=function(t,o){return new s(t).signPropagatingRightShift(o)},i.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},i.prototype.rightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)>>>t);return this},i.prototype.rightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)>>>t.get(o,n));return this},i.rightShift=function(t,o){return new s(t).rightShift(o)},i.prototype.zeroFillRightShift=i.prototype.rightShift,i.prototype.zeroFillRightShiftS=i.prototype.rightShiftS,i.prototype.zeroFillRightShiftM=i.prototype.rightShiftM,i.zeroFillRightShift=i.rightShift,i.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,~this.get(t,o));return this},i.not=function(t){return new s(t).not()},i.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.abs(this.get(t,o)));return this},i.abs=function(t){return new s(t).abs()},i.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acos(this.get(t,o)));return this},i.acos=function(t){return new s(t).acos()},i.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acosh(this.get(t,o)));return this},i.acosh=function(t){return new s(t).acosh()},i.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asin(this.get(t,o)));return this},i.asin=function(t){return new s(t).asin()},i.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asinh(this.get(t,o)));return this},i.asinh=function(t){return new s(t).asinh()},i.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atan(this.get(t,o)));return this},i.atan=function(t){return new s(t).atan()},i.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atanh(this.get(t,o)));return this},i.atanh=function(t){return new s(t).atanh()},i.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cbrt(this.get(t,o)));return this},i.cbrt=function(t){return new s(t).cbrt()},i.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.ceil(this.get(t,o)));return this},i.ceil=function(t){return new s(t).ceil()},i.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.clz32(this.get(t,o)));return this},i.clz32=function(t){return new s(t).clz32()},i.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cos(this.get(t,o)));return this},i.cos=function(t){return new s(t).cos()},i.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cosh(this.get(t,o)));return this},i.cosh=function(t){return new s(t).cosh()},i.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.exp(this.get(t,o)));return this},i.exp=function(t){return new s(t).exp()},i.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.expm1(this.get(t,o)));return this},i.expm1=function(t){return new s(t).expm1()},i.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.floor(this.get(t,o)));return this},i.floor=function(t){return new s(t).floor()},i.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.fround(this.get(t,o)));return this},i.fround=function(t){return new s(t).fround()},i.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log(this.get(t,o)));return this},i.log=function(t){return new s(t).log()},i.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log1p(this.get(t,o)));return this},i.log1p=function(t){return new s(t).log1p()},i.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log10(this.get(t,o)));return this},i.log10=function(t){return new s(t).log10()},i.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log2(this.get(t,o)));return this},i.log2=function(t){return new s(t).log2()},i.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.round(this.get(t,o)));return this},i.round=function(t){return new s(t).round()},i.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sign(this.get(t,o)));return this},i.sign=function(t){return new s(t).sign()},i.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sin(this.get(t,o)));return this},i.sin=function(t){return new s(t).sin()},i.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sinh(this.get(t,o)));return this},i.sinh=function(t){return new s(t).sinh()},i.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sqrt(this.get(t,o)));return this},i.sqrt=function(t){return new s(t).sqrt()},i.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tan(this.get(t,o)));return this},i.tan=function(t){return new s(t).tan()},i.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tanh(this.get(t,o)));return this},i.tanh=function(t){return new s(t).tanh()},i.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.trunc(this.get(t,o)));return this},i.trunc=function(t){return new s(t).trunc()},i.pow=function(t,o){return new s(t).pow(o)},i.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},i.prototype.powS=function(t){for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)**t);return this},i.prototype.powM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let n=0;n<this.columns;n++)this.set(o,n,this.get(o,n)**t.get(o,n));return this}}function ut(i,s,e){let t=e?i.rows:i.rows-1;if(s<0||s>t)throw new RangeError("Row index out of range")}function ft(i,s,e){let t=e?i.columns:i.columns-1;if(s<0||s>t)throw new RangeError("Column index out of range")}function It(i,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==i.columns)throw new RangeError("vector size must be the same as the number of columns");return s}function Mt(i,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==i.rows)throw new RangeError("vector size must be the same as the number of rows");return s}function se(i,s){if(!lt.isAnyArray(s))throw new TypeError("row indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=i.rows)throw new RangeError("row indices are out of range")}function oe(i,s){if(!lt.isAnyArray(s))throw new TypeError("column indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=i.columns)throw new RangeError("column indices are out of range")}function Ht(i,s,e,t,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Nt("startRow",s),Nt("endRow",e),Nt("startColumn",t),Nt("endColumn",o),s>e||t>o||s<0||s>=i.rows||e<0||e>=i.rows||t<0||t>=i.columns||o<0||o>=i.columns)throw new RangeError("Submatrix indices are out of range")}function Xt(i,s=0){let e=[];for(let t=0;t<i;t++)e.push(s);return e}function Nt(i,s){if(typeof s!="number")throw new TypeError(`${i} must be a number`)}function jt(i){if(i.isEmpty())throw new Error("Empty matrix has no elements to index")}function qe(i){let s=Xt(i.rows);for(let e=0;e<i.rows;++e)for(let t=0;t<i.columns;++t)s[e]+=i.get(e,t);return s}function Oe(i){let s=Xt(i.columns);for(let e=0;e<i.rows;++e)for(let t=0;t<i.columns;++t)s[t]+=i.get(e,t);return s}function ze(i){let s=0;for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)s+=i.get(e,t);return s}function We(i){let s=Xt(i.rows,1);for(let e=0;e<i.rows;++e)for(let t=0;t<i.columns;++t)s[e]*=i.get(e,t);return s}function Ye(i){let s=Xt(i.columns,1);for(let e=0;e<i.rows;++e)for(let t=0;t<i.columns;++t)s[t]*=i.get(e,t);return s}function Xe(i){let s=1;for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)s*=i.get(e,t);return s}function Ae(i,s,e){const t=i.rows,o=i.columns,n=[];for(let r=0;r<t;r++){let l=0,a=0,h=0;for(let u=0;u<o;u++)h=i.get(r,u)-e[r],l+=h,a+=h*h;s?n.push((a-l*l/o)/(o-1)):n.push((a-l*l/o)/o)}return n}function Ue(i,s,e){const t=i.rows,o=i.columns,n=[];for(let r=0;r<o;r++){let l=0,a=0,h=0;for(let u=0;u<t;u++)h=i.get(u,r)-e[r],l+=h,a+=h*h;s?n.push((a-l*l/t)/(t-1)):n.push((a-l*l/t)/t)}return n}function Ge(i,s,e){const t=i.rows,o=i.columns,n=t*o;let r=0,l=0,a=0;for(let h=0;h<t;h++)for(let u=0;u<o;u++)a=i.get(h,u)-e,r+=a,l+=a*a;return s?(l-r*r/n)/(n-1):(l-r*r/n)/n}function Je(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)-s[e])}function Ke(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)-s[t])}function Qe(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)-s)}function Ze(i){const s=[];for(let e=0;e<i.rows;e++){let t=0;for(let o=0;o<i.columns;o++)t+=i.get(e,o)**2/(i.columns-1);s.push(Math.sqrt(t))}return s}function He(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)/s[e])}function ts(i){const s=[];for(let e=0;e<i.columns;e++){let t=0;for(let o=0;o<i.rows;o++)t+=i.get(o,e)**2/(i.rows-1);s.push(Math.sqrt(t))}return s}function es(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)/s[t])}function ss(i){const s=i.size-1;let e=0;for(let t=0;t<i.columns;t++)for(let o=0;o<i.rows;o++)e+=i.get(o,t)**2/s;return Math.sqrt(e)}function os(i,s){for(let e=0;e<i.rows;e++)for(let t=0;t<i.columns;t++)i.set(e,t,i.get(e,t)/s)}class W{static from1DArray(s,e,t){if(s*e!==t.length)throw new RangeError("data length does not match given dimensions");let n=new R(s,e);for(let r=0;r<s;r++)for(let l=0;l<e;l++)n.set(r,l,t[r*e+l]);return n}static rowVector(s){let e=new R(1,s.length);for(let t=0;t<s.length;t++)e.set(0,t,s[t]);return e}static columnVector(s){let e=new R(s.length,1);for(let t=0;t<s.length;t++)e.set(t,0,s[t]);return e}static zeros(s,e){return new R(s,e)}static ones(s,e){return new R(s,e).fill(1)}static rand(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=t;let n=new R(s,e);for(let r=0;r<s;r++)for(let l=0;l<e;l++)n.set(r,l,o());return n}static randInt(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:o=0,max:n=1e3,random:r=Math.random}=t;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(o>=n)throw new RangeError("min must be smaller than max");let l=n-o,a=new R(s,e);for(let h=0;h<s;h++)for(let u=0;u<e;u++){let c=o+Math.round(r()*l);a.set(h,u,c)}return a}static eye(s,e,t){e===void 0&&(e=s),t===void 0&&(t=1);let o=Math.min(s,e),n=this.zeros(s,e);for(let r=0;r<o;r++)n.set(r,r,t);return n}static diag(s,e,t){let o=s.length;e===void 0&&(e=o),t===void 0&&(t=e);let n=Math.min(o,e,t),r=this.zeros(e,t);for(let l=0;l<n;l++)r.set(l,l,s[l]);return r}static min(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,o=s.columns,n=new R(t,o);for(let r=0;r<t;r++)for(let l=0;l<o;l++)n.set(r,l,Math.min(s.get(r,l),e.get(r,l)));return n}static max(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,o=s.columns,n=new this(t,o);for(let r=0;r<t;r++)for(let l=0;l<o;l++)n.set(r,l,Math.max(s.get(r,l),e.get(r,l)));return n}static checkMatrix(s){return W.isMatrix(s)?s:new R(s)}static isMatrix(s){return s!=null&&s.klass==="Matrix"}get size(){return this.rows*this.columns}apply(s){if(typeof s!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.call(this,e,t);return this}to1DArray(){let s=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.push(this.get(e,t));return s}to2DArray(){let s=[];for(let e=0;e<this.rows;e++){s.push([]);for(let t=0;t<this.columns;t++)s[e].push(this.get(e,t))}return s}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let s=0;s<this.rows;s++)for(let e=0;e<=s;e++)if(this.get(s,e)!==this.get(e,s))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let s=0;s<this.rows;s++)if(this.get(s,s)!==0)return!1;return!0}isEchelonForm(){let s=0,e=0,t=-1,o=!0,n=!1;for(;s<this.rows&&o;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(n=!0,t=e):(o=!1,n=!0);s++}return o}isReducedEchelonForm(){let s=0,e=0,t=-1,o=!0,n=!1;for(;s<this.rows&&o;){for(e=0,n=!1;e<this.columns&&n===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(n=!0,t=e):(o=!1,n=!0);for(let r=e+1;r<this.rows;r++)this.get(s,r)!==0&&(o=!1);s++}return o}echelonForm(){let s=this.clone(),e=0,t=0;for(;e<s.rows&&t<s.columns;){let o=e;for(let n=e;n<s.rows;n++)s.get(n,t)>s.get(o,t)&&(o=n);if(s.get(o,t)===0)t++;else{s.swapRows(e,o);let n=s.get(e,t);for(let r=t;r<s.columns;r++)s.set(e,r,s.get(e,r)/n);for(let r=e+1;r<s.rows;r++){let l=s.get(r,t)/s.get(e,t);s.set(r,t,0);for(let a=t+1;a<s.columns;a++)s.set(r,a,s.get(r,a)-s.get(e,a)*l)}e++,t++}}return s}reducedEchelonForm(){let s=this.echelonForm(),e=s.columns,t=s.rows,o=t-1;for(;o>=0;)if(s.maxRow(o)===0)o--;else{let n=0,r=!1;for(;n<t&&r===!1;)s.get(o,n)===1?r=!0:n++;for(let l=0;l<o;l++){let a=s.get(l,n);for(let h=n;h<e;h++){let u=s.get(l,h)-a*s.get(o,h);s.set(l,h,u)}}o--}return s}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=s;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let o=new R(this.rows*e,this.columns*t);for(let n=0;n<e;n++)for(let r=0;r<t;r++)o.setSubMatrix(this,this.rows*n,this.columns*r);return o}fill(s){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,s);return this}neg(){return this.mulS(-1)}getRow(s){ut(this,s);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(s,t));return e}getRowVector(s){return R.rowVector(this.getRow(s))}setRow(s,e){ut(this,s),e=It(this,e);for(let t=0;t<this.columns;t++)this.set(s,t,e[t]);return this}swapRows(s,e){ut(this,s),ut(this,e);for(let t=0;t<this.columns;t++){let o=this.get(s,t);this.set(s,t,this.get(e,t)),this.set(e,t,o)}return this}getColumn(s){ft(this,s);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,s));return e}getColumnVector(s){return R.columnVector(this.getColumn(s))}setColumn(s,e){ft(this,s),e=Mt(this,e);for(let t=0;t<this.rows;t++)this.set(t,s,e[t]);return this}swapColumns(s,e){ft(this,s),ft(this,e);for(let t=0;t<this.rows;t++){let o=this.get(t,s);this.set(t,s,this.get(t,e)),this.set(t,e,o)}return this}addRowVector(s){s=It(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[t]);return this}subRowVector(s){s=It(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[t]);return this}mulRowVector(s){s=It(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[t]);return this}divRowVector(s){s=It(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[t]);return this}addColumnVector(s){s=Mt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[e]);return this}subColumnVector(s){s=Mt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[e]);return this}mulColumnVector(s){s=Mt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[e]);return this}divColumnVector(s){s=Mt(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[e]);return this}mulRow(s,e){ut(this,s);for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e);return this}mulColumn(s,e){ft(this,s);for(let t=0;t<this.rows;t++)this.set(t,s,this.get(t,s)*e);return this}max(s){if(this.isEmpty())return NaN;switch(s){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e[t]&&(e[t]=this.get(t,o));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e[o]&&(e[o]=this.get(t,o));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o));return e}default:throw new Error(`invalid option: ${s}`)}}maxIndex(){jt(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>s&&(s=this.get(t,o),e[0]=t,e[1]=o);return e}min(s){if(this.isEmpty())return NaN;switch(s){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e[t]&&(e[t]=this.get(t,o));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e[o]&&(e[o]=this.get(t,o));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o));return e}default:throw new Error(`invalid option: ${s}`)}}minIndex(){jt(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<s&&(s=this.get(t,o),e[0]=t,e[1]=o);return e}maxRow(s){if(ut(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)>e&&(e=this.get(s,t));return e}maxRowIndex(s){ut(this,s),jt(this);let e=this.get(s,0),t=[s,0];for(let o=1;o<this.columns;o++)this.get(s,o)>e&&(e=this.get(s,o),t[1]=o);return t}minRow(s){if(ut(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)<e&&(e=this.get(s,t));return e}minRowIndex(s){ut(this,s),jt(this);let e=this.get(s,0),t=[s,0];for(let o=1;o<this.columns;o++)this.get(s,o)<e&&(e=this.get(s,o),t[1]=o);return t}maxColumn(s){if(ft(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)>e&&(e=this.get(t,s));return e}maxColumnIndex(s){ft(this,s),jt(this);let e=this.get(0,s),t=[0,s];for(let o=1;o<this.rows;o++)this.get(o,s)>e&&(e=this.get(o,s),t[0]=o);return t}minColumn(s){if(ft(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)<e&&(e=this.get(t,s));return e}minColumnIndex(s){ft(this,s),jt(this);let e=this.get(0,s),t=[0,s];for(let o=1;o<this.rows;o++)this.get(o,s)<e&&(e=this.get(o,s),t[0]=o);return t}diag(){let s=Math.min(this.rows,this.columns),e=[];for(let t=0;t<s;t++)e.push(this.get(t,t));return e}norm(s="frobenius"){switch(s){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${s}`)}}cumulativeSum(){let s=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s+=this.get(e,t),this.set(e,t,s);return this}dot(s){W.isMatrix(s)&&(s=s.to1DArray());let e=this.to1DArray();if(e.length!==s.length)throw new RangeError("vectors do not have the same size");let t=0;for(let o=0;o<e.length;o++)t+=e[o]*s[o];return t}mmul(s){s=R.checkMatrix(s);let e=this.rows,t=this.columns,o=s.columns,n=new R(e,o),r=new Float64Array(t);for(let l=0;l<o;l++){for(let a=0;a<t;a++)r[a]=s.get(a,l);for(let a=0;a<e;a++){let h=0;for(let u=0;u<t;u++)h+=this.get(a,u)*r[u];n.set(a,l,h)}}return n}mpow(s){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(s)||s<0)throw new RangeError("Exponent must be a non-negative integer");let e=R.eye(this.rows),t=this;for(let o=s;o>=1;o/=2)o&1&&(e=e.mmul(t)),t=t.mmul(t);return e}strassen2x2(s){s=R.checkMatrix(s);let e=new R(2,2);const t=this.get(0,0),o=s.get(0,0),n=this.get(0,1),r=s.get(0,1),l=this.get(1,0),a=s.get(1,0),h=this.get(1,1),u=s.get(1,1),c=(t+h)*(o+u),w=(l+h)*o,v=t*(r-u),m=h*(a-o),p=(t+n)*u,S=(l-t)*(o+r),f=(n-h)*(a+u),E=c+m-p+f,k=v+p,T=w+m,C=c-w+v+S;return e.set(0,0,E),e.set(0,1,k),e.set(1,0,T),e.set(1,1,C),e}strassen3x3(s){s=R.checkMatrix(s);let e=new R(3,3);const t=this.get(0,0),o=this.get(0,1),n=this.get(0,2),r=this.get(1,0),l=this.get(1,1),a=this.get(1,2),h=this.get(2,0),u=this.get(2,1),c=this.get(2,2),w=s.get(0,0),v=s.get(0,1),m=s.get(0,2),p=s.get(1,0),S=s.get(1,1),f=s.get(1,2),E=s.get(2,0),k=s.get(2,1),T=s.get(2,2),C=(t+o+n-r-l-u-c)*S,V=(t-r)*(-v+S),P=l*(-w+v+p-S-f-E+T),B=(-t+r+l)*(w-v+S),N=(r+l)*(-w+v),g=t*w,x=(-t+h+u)*(w-m+f),M=(-t+h)*(m-f),j=(h+u)*(-w+m),Y=(t+o+n-l-a-h-u)*f,z=u*(-w+m+p-S-f-E+k),$=(-n+u+c)*(S+E-k),q=(n-c)*(S-k),J=n*E,Q=(u+c)*(-E+k),A=(-n+l+a)*(f+E-T),et=(n-a)*(f-T),st=(l+a)*(-E+T),O=o*p,G=a*k,Z=r*m,y=h*v,b=c*T,I=g+J+O,_=C+B+N+g+$+J+Q,L=g+x+j+Y+J+A+st,F=V+P+B+g+J+A+et,D=V+B+N+g+G,X=J+A+et+st+Z,H=g+x+M+z+$+q+J,vt=$+q+J+Q+y,dt=g+x+M+j+b;return e.set(0,0,I),e.set(0,1,_),e.set(0,2,L),e.set(1,0,F),e.set(1,1,D),e.set(1,2,X),e.set(2,0,H),e.set(2,1,vt),e.set(2,2,dt),e}mmulStrassen(s){s=R.checkMatrix(s);let e=this.clone(),t=e.rows,o=e.columns,n=s.rows,r=s.columns;o!==n&&console.warn(`Multiplying ${t} x ${o} and ${n} x ${r} matrix: dimensions do not match.`);function l(c,w,v){let m=c.rows,p=c.columns;if(m===w&&p===v)return c;{let S=W.zeros(w,v);return S=S.setSubMatrix(c,0,0),S}}let a=Math.max(t,n),h=Math.max(o,r);e=l(e,a,h),s=l(s,a,h);function u(c,w,v,m){if(v<=512||m<=512)return c.mmul(w);v%2===1&&m%2===1?(c=l(c,v+1,m+1),w=l(w,v+1,m+1)):v%2===1?(c=l(c,v+1,m),w=l(w,v+1,m)):m%2===1&&(c=l(c,v,m+1),w=l(w,v,m+1));let p=parseInt(c.rows/2,10),S=parseInt(c.columns/2,10),f=c.subMatrix(0,p-1,0,S-1),E=w.subMatrix(0,p-1,0,S-1),k=c.subMatrix(0,p-1,S,c.columns-1),T=w.subMatrix(0,p-1,S,w.columns-1),C=c.subMatrix(p,c.rows-1,0,S-1),V=w.subMatrix(p,w.rows-1,0,S-1),P=c.subMatrix(p,c.rows-1,S,c.columns-1),B=w.subMatrix(p,w.rows-1,S,w.columns-1),N=u(W.add(f,P),W.add(E,B),p,S),g=u(W.add(C,P),E,p,S),x=u(f,W.sub(T,B),p,S),M=u(P,W.sub(V,E),p,S),j=u(W.add(f,k),B,p,S),Y=u(W.sub(C,f),W.add(E,T),p,S),z=u(W.sub(k,P),W.add(V,B),p,S),$=W.add(N,M);$.sub(j),$.add(z);let q=W.add(x,j),J=W.add(g,M),Q=W.sub(N,g);Q.add(x),Q.add(Y);let A=W.zeros(2*$.rows,2*$.columns);return A=A.setSubMatrix($,0,0),A=A.setSubMatrix(q,$.rows,0),A=A.setSubMatrix(J,0,$.columns),A=A.setSubMatrix(Q,$.rows,$.columns),A.subMatrix(0,v-1,0,m-1)}return u(e,s,a,h)}scaleRows(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let o=new R(this.rows,this.columns);for(let n=0;n<this.rows;n++){const r=this.getRow(n);r.length>0&&le(r,{min:e,max:t,output:r}),o.setRow(n,r)}return o}scaleColumns(s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let o=new R(this.rows,this.columns);for(let n=0;n<this.columns;n++){const r=this.getColumn(n);r.length&&le(r,{min:e,max:t,output:r}),o.setColumn(n,r)}return o}flipRows(){const s=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<s;t++){let o=this.get(e,t),n=this.get(e,this.columns-1-t);this.set(e,t,n),this.set(e,this.columns-1-t,o)}return this}flipColumns(){const s=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<s;t++){let o=this.get(t,e),n=this.get(this.rows-1-t,e);this.set(t,e,n),this.set(this.rows-1-t,e,o)}return this}kroneckerProduct(s){s=R.checkMatrix(s);let e=this.rows,t=this.columns,o=s.rows,n=s.columns,r=new R(e*o,t*n);for(let l=0;l<e;l++)for(let a=0;a<t;a++)for(let h=0;h<o;h++)for(let u=0;u<n;u++)r.set(o*l+h,n*a+u,this.get(l,a)*s.get(h,u));return r}kroneckerSum(s){if(s=R.checkMatrix(s),!this.isSquare()||!s.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=s.rows,o=this.kroneckerProduct(R.eye(t,t)),n=R.eye(e,e).kroneckerProduct(s);return o.add(n)}transpose(){let s=new R(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.set(t,e,this.get(e,t));return s}sortRows(s=he){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(s));return this}sortColumns(s=he){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(s));return this}subMatrix(s,e,t,o){Ht(this,s,e,t,o);let n=new R(e-s+1,o-t+1);for(let r=s;r<=e;r++)for(let l=t;l<=o;l++)n.set(r-s,l-t,this.get(r,l));return n}subMatrixRow(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let o=new R(s.length,t-e+1);for(let n=0;n<s.length;n++)for(let r=e;r<=t;r++){if(s[n]<0||s[n]>=this.rows)throw new RangeError(`Row index out of range: ${s[n]}`);o.set(n,r-e,this.get(s[n],r))}return o}subMatrixColumn(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let o=new R(t-e+1,s.length);for(let n=0;n<s.length;n++)for(let r=e;r<=t;r++){if(s[n]<0||s[n]>=this.columns)throw new RangeError(`Column index out of range: ${s[n]}`);o.set(r-e,n,this.get(r,s[n]))}return o}setSubMatrix(s,e,t){if(s=R.checkMatrix(s),s.isEmpty())return this;let o=e+s.rows-1,n=t+s.columns-1;Ht(this,e,o,t,n);for(let r=0;r<s.rows;r++)for(let l=0;l<s.columns;l++)this.set(e+r,t+l,s.get(r,l));return this}selection(s,e){se(this,s),oe(this,e);let t=new R(s.length,e.length);for(let o=0;o<s.length;o++){let n=s[o];for(let r=0;r<e.length;r++){let l=e[r];t.set(o,r,this.get(n,l))}}return t}trace(){let s=Math.min(this.rows,this.columns),e=0;for(let t=0;t<s;t++)e+=this.get(t,t);return e}clone(){return this.constructor.copy(this,new R(this.rows,this.columns))}static copy(s,e){for(const[t,o,n]of s.entries())e.set(t,o,n);return e}sum(s){switch(s){case"row":return qe(this);case"column":return Oe(this);case void 0:return ze(this);default:throw new Error(`invalid option: ${s}`)}}product(s){switch(s){case"row":return We(this);case"column":return Ye(this);case void 0:return Xe(this);default:throw new Error(`invalid option: ${s}`)}}mean(s){const e=this.sum(s);switch(s){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${s}`)}}variance(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:o=this.mean(s)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(s){case"row":{if(!lt.isAnyArray(o))throw new TypeError("mean must be an array");return Ae(this,t,o)}case"column":{if(!lt.isAnyArray(o))throw new TypeError("mean must be an array");return Ue(this,t,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return Ge(this,t,o)}default:throw new Error(`invalid option: ${s}`)}}standardDeviation(s,e){typeof s=="object"&&(e=s,s=void 0);const t=this.variance(s,e);if(s===void 0)return Math.sqrt(t);for(let o=0;o<t.length;o++)t[o]=Math.sqrt(t[o]);return t}center(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(s)}=e;switch(s){case"row":{if(!lt.isAnyArray(t))throw new TypeError("center must be an array");return Je(this,t),this}case"column":{if(!lt.isAnyArray(t))throw new TypeError("center must be an array");return Ke(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Qe(this,t),this}default:throw new Error(`invalid option: ${s}`)}}scale(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(s){case"row":{if(t===void 0)t=Ze(this);else if(!lt.isAnyArray(t))throw new TypeError("scale must be an array");return He(this,t),this}case"column":{if(t===void 0)t=ts(this);else if(!lt.isAnyArray(t))throw new TypeError("scale must be an array");return es(this,t),this}case void 0:{if(t===void 0)t=ss(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return os(this,t),this}default:throw new Error(`invalid option: ${s}`)}}toString(s){return ye(this,s)}[Symbol.iterator](){return this.entries()}*entries(){for(let s=0;s<this.rows;s++)for(let e=0;e<this.columns;e++)yield[s,e,this.get(s,e)]}*values(){for(let s=0;s<this.rows;s++)for(let e=0;e<this.columns;e++)yield this.get(s,e)}}W.prototype.klass="Matrix";typeof Symbol<"u"&&(W.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ne);function he(i,s){return i-s}function ns(i){return i.every(s=>typeof s=="number")}W.random=W.rand;W.randomInt=W.randInt;W.diagonal=W.diag;W.prototype.diagonal=W.prototype.diag;W.identity=W.eye;W.prototype.negate=W.prototype.neg;W.prototype.tensorProduct=W.prototype.kroneckerProduct;var Rt,te,Et;let R=(Et=class extends W{constructor(e,t){super();Kt(this,Rt);re(this,"data");if(Et.isMatrix(e))Qt(this,Rt,te).call(this,e.rows,e.columns),Et.copy(e,this);else if(Number.isInteger(e)&&e>=0)Qt(this,Rt,te).call(this,e,t);else if(lt.isAnyArray(e)){const o=e;if(e=o.length,t=e?o[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(o[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!ns(o[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(o[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,o){return this.data[e][t]=o,this}get(e,t){return this.data[e][t]}removeRow(e){return ut(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),ut(this,e,!0),t=Float64Array.from(It(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){ft(this,e);for(let t=0;t<this.rows;t++){const o=new Float64Array(this.columns-1);for(let n=0;n<e;n++)o[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)o[n-1]=this.data[t][n];this.data[t]=o}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),ft(this,e,!0),t=Mt(this,t);for(let o=0;o<this.rows;o++){const n=new Float64Array(this.columns+1);let r=0;for(;r<e;r++)n[r]=this.data[o][r];for(n[r++]=t[o];r<this.columns+1;r++)n[r]=this.data[o][r-1];this.data[o]=n}return this.columns+=1,this}},Rt=new WeakSet,te=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let o=0;o<e;o++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t},Et);Ve(W,R);var it;const Yt=class Yt extends W{constructor(e){super();Kt(this,it);if(R.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Dt(this,it,R.copy(e,new R(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Dt(this,it,new R(e,e));else if(Dt(this,it,new R(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return gt(this,it).size}get rows(){return gt(this,it).rows}get columns(){return gt(this,it).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return R.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Yt(this.diagonalSize);for(const[t,o,n]of this.upperRightEntries())e.set(t,o,n);return e}toMatrix(){return new R(this)}get(e,t){return gt(this,it).get(e,t)}set(e,t,o){return gt(this,it).set(e,t,o),gt(this,it).set(t,e,o),this}removeCross(e){return gt(this,it).removeRow(e),gt(this,it).removeColumn(e),this}addCross(e,t){t===void 0&&(t=e,e=this.diagonalSize);const o=t.slice();return o.splice(e,1),gt(this,it).addRow(e,o),gt(this,it).addColumn(e,t),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[o,n]of e.entries())n||t.push(o);t.reverse();for(const o of t)this.removeCross(o);return this}toCompact(){const{diagonalSize:e}=this,t=new Array(e*(e+1)/2);for(let o=0,n=0,r=0;r<t.length;r++)t[r]=this.get(n,o),++o>=e&&(o=++n);return t}static fromCompact(e){const t=e.length,o=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(o))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const n=new Yt(o);for(let r=0,l=0,a=0;a<t;a++)n.set(r,l,e[a]),++r>=o&&(r=++l);return n}*upperRightEntries(){for(let e=0,t=0;e<this.diagonalSize;void 0){const o=this.get(e,t);yield[e,t,o],++t>=this.diagonalSize&&(t=++e)}}*upperRightValues(){for(let e=0,t=0;e<this.diagonalSize;void 0)yield this.get(e,t),++t>=this.diagonalSize&&(t=++e)}};it=new WeakMap;let St=Yt;St.prototype.klassType="SymmetricMatrix";class At extends St{static isDistanceMatrix(s){return St.isSymmetricMatrix(s)&&s.klassSubType==="DistanceMatrix"}constructor(s){if(super(s),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(s,e,t){return s===e&&(t=0),super.set(s,e,t)}addCross(s,e){return e===void 0&&(e=s,s=this.diagonalSize),e=e.slice(),e[s]=0,super.addCross(s,e)}toSymmetricMatrix(){return new St(this)}clone(){const s=new At(this.diagonalSize);for(const[e,t,o]of this.upperRightEntries())e!==t&&s.set(e,t,o);return s}toCompact(){const{diagonalSize:s}=this,e=(s-1)*s/2,t=new Array(e);for(let o=1,n=0,r=0;r<t.length;r++)t[r]=this.get(n,o),++o>=s&&(o=++n+1);return t}static fromCompact(s){const e=s.length;if(e===0)return new this(0);const t=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(s)}`);const o=new this(t);for(let n=1,r=0,l=0;l<e;l++)o.set(n,r,s[l]),++n>=t&&(n=++r+1);return o}}At.prototype.klassSubType="DistanceMatrix";class yt extends W{constructor(s,e,t){super(),this.matrix=s,this.rows=e,this.columns=t}}class is extends yt{constructor(s,e){ft(s,e),super(s,s.rows,1),this.column=e}set(s,e,t){return this.matrix.set(s,this.column,t),this}get(s){return this.matrix.get(s,this.column)}}class rs extends yt{constructor(s,e){oe(s,e),super(s,s.rows,e.length),this.columnIndices=e}set(s,e,t){return this.matrix.set(s,this.columnIndices[e],t),this}get(s,e){return this.matrix.get(s,this.columnIndices[e])}}class ls extends yt{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(s,this.columns-e-1,t),this}get(s,e){return this.matrix.get(s,this.columns-e-1)}}class cs extends yt{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(this.rows-s-1,e,t),this}get(s,e){return this.matrix.get(this.rows-s-1,e)}}class hs extends yt{constructor(s,e){ut(s,e),super(s,1,s.columns),this.row=e}set(s,e,t){return this.matrix.set(this.row,e,t),this}get(s,e){return this.matrix.get(this.row,e)}}class as extends yt{constructor(s,e){se(s,e),super(s,e.length,s.columns),this.rowIndices=e}set(s,e,t){return this.matrix.set(this.rowIndices[s],e,t),this}get(s,e){return this.matrix.get(this.rowIndices[s],e)}}class qt extends yt{constructor(s,e,t){se(s,e),oe(s,t),super(s,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(s,e,t){return this.matrix.set(this.rowIndices[s],this.columnIndices[e],t),this}get(s,e){return this.matrix.get(this.rowIndices[s],this.columnIndices[e])}}class us extends yt{constructor(s,e,t,o,n){Ht(s,e,t,o,n),super(s,t-e+1,n-o+1),this.startRow=e,this.startColumn=o}set(s,e,t){return this.matrix.set(this.startRow+s,this.startColumn+e,t),this}get(s,e){return this.matrix.get(this.startRow+s,this.startColumn+e)}}class fs extends yt{constructor(s){super(s,s.columns,s.rows)}set(s,e,t){return this.matrix.set(e,s,t),this}get(s,e){return this.matrix.get(e,s)}}class ve extends W{constructor(s,e={}){const{rows:t=1}=e;if(s.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=s.length/t,this.data=s}set(s,e,t){let o=this._calculateIndex(s,e);return this.data[o]=t,this}get(s,e){let t=this._calculateIndex(s,e);return this.data[t]}_calculateIndex(s,e){return s*this.columns+e}}class at extends W{constructor(s){super(),this.data=s,this.rows=s.length,this.columns=s[0].length}set(s,e,t){return this.data[s][e]=t,this}get(s,e){return this.data[s][e]}}function gs(i,s){if(lt.isAnyArray(i))return i[0]&&lt.isAnyArray(i[0])?new at(i):new ve(i,s);throw new Error("the argument is not an array")}class Ut{constructor(s){s=at.checkMatrix(s);let e=s.clone(),t=e.rows,o=e.columns,n=new Float64Array(t),r=1,l,a,h,u,c,w,v,m,p;for(l=0;l<t;l++)n[l]=l;for(m=new Float64Array(t),a=0;a<o;a++){for(l=0;l<t;l++)m[l]=e.get(l,a);for(l=0;l<t;l++){for(p=Math.min(l,a),c=0,h=0;h<p;h++)c+=e.get(l,h)*m[h];m[l]-=c,e.set(l,a,m[l])}for(u=a,l=a+1;l<t;l++)Math.abs(m[l])>Math.abs(m[u])&&(u=l);if(u!==a){for(h=0;h<o;h++)w=e.get(u,h),e.set(u,h,e.get(a,h)),e.set(a,h,w);v=n[u],n[u]=n[a],n[a]=v,r=-r}if(a<t&&e.get(a,a)!==0)for(l=a+1;l<t;l++)e.set(l,a,e.get(l,a)/e.get(a,a))}this.LU=e,this.pivotVector=n,this.pivotSign=r}isSingular(){let s=this.LU,e=s.columns;for(let t=0;t<e;t++)if(s.get(t,t)===0)return!0;return!1}solve(s){s=R.checkMatrix(s);let e=this.LU;if(e.rows!==s.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=s.columns,n=s.subMatrixRow(this.pivotVector,0,o-1),r=e.columns,l,a,h;for(h=0;h<r;h++)for(l=h+1;l<r;l++)for(a=0;a<o;a++)n.set(l,a,n.get(l,a)-n.get(h,a)*e.get(l,h));for(h=r-1;h>=0;h--){for(a=0;a<o;a++)n.set(h,a,n.get(h,a)/e.get(h,h));for(l=0;l<h;l++)for(a=0;a<o;a++)n.set(l,a,n.get(l,a)-n.get(h,a)*e.get(l,h))}return n}get determinant(){let s=this.LU;if(!s.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=s.columns;for(let o=0;o<t;o++)e*=s.get(o,o);return e}get lowerTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,o=new R(e,t);for(let n=0;n<e;n++)for(let r=0;r<t;r++)n>r?o.set(n,r,s.get(n,r)):n===r?o.set(n,r,1):o.set(n,r,0);return o}get upperTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,o=new R(e,t);for(let n=0;n<e;n++)for(let r=0;r<t;r++)n<=r?o.set(n,r,s.get(n,r)):o.set(n,r,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function pt(i,s){let e=0;return Math.abs(i)>Math.abs(s)?(e=s/i,Math.abs(i)*Math.sqrt(1+e*e)):s!==0?(e=i/s,Math.abs(s)*Math.sqrt(1+e*e)):0}class ne{constructor(s){s=at.checkMatrix(s);let e=s.clone(),t=s.rows,o=s.columns,n=new Float64Array(o),r,l,a,h;for(a=0;a<o;a++){let u=0;for(r=a;r<t;r++)u=pt(u,e.get(r,a));if(u!==0){for(e.get(a,a)<0&&(u=-u),r=a;r<t;r++)e.set(r,a,e.get(r,a)/u);for(e.set(a,a,e.get(a,a)+1),l=a+1;l<o;l++){for(h=0,r=a;r<t;r++)h+=e.get(r,a)*e.get(r,l);for(h=-h/e.get(a,a),r=a;r<t;r++)e.set(r,l,e.get(r,l)+h*e.get(r,a))}}n[a]=-u}this.QR=e,this.Rdiag=n}solve(s){s=R.checkMatrix(s);let e=this.QR,t=e.rows;if(s.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=s.columns,n=s.clone(),r=e.columns,l,a,h,u;for(h=0;h<r;h++)for(a=0;a<o;a++){for(u=0,l=h;l<t;l++)u+=e.get(l,h)*n.get(l,a);for(u=-u/e.get(h,h),l=h;l<t;l++)n.set(l,a,n.get(l,a)+u*e.get(l,h))}for(h=r-1;h>=0;h--){for(a=0;a<o;a++)n.set(h,a,n.get(h,a)/this.Rdiag[h]);for(l=0;l<h;l++)for(a=0;a<o;a++)n.set(l,a,n.get(l,a)-n.get(h,a)*e.get(l,h))}return n.subMatrix(0,r-1,0,o-1)}isFullRank(){let s=this.QR.columns;for(let e=0;e<s;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let s=this.QR,e=s.columns,t=new R(e,e),o,n;for(o=0;o<e;o++)for(n=0;n<e;n++)o<n?t.set(o,n,s.get(o,n)):o===n?t.set(o,n,this.Rdiag[o]):t.set(o,n,0);return t}get orthogonalMatrix(){let s=this.QR,e=s.rows,t=s.columns,o=new R(e,t),n,r,l,a;for(l=t-1;l>=0;l--){for(n=0;n<e;n++)o.set(n,l,0);for(o.set(l,l,1),r=l;r<t;r++)if(s.get(l,l)!==0){for(a=0,n=l;n<e;n++)a+=s.get(n,l)*o.get(n,r);for(a=-a/s.get(l,l),n=l;n<e;n++)o.set(n,r,o.get(n,r)+a*s.get(n,l))}}return o}}class Bt{constructor(s,e={}){if(s=at.checkMatrix(s),s.isEmpty())throw new Error("Matrix must be non-empty");let t=s.rows,o=s.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:r=!0,autoTranspose:l=!1}=e;let a=!!n,h=!!r,u=!1,c;if(t<o)if(!l)c=s.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{c=s.transpose(),t=c.rows,o=c.columns,u=!0;let g=a;a=h,h=g}else c=s.clone();let w=Math.min(t,o),v=Math.min(t+1,o),m=new Float64Array(v),p=new R(t,w),S=new R(o,o),f=new Float64Array(o),E=new Float64Array(t),k=new Float64Array(v);for(let g=0;g<v;g++)k[g]=g;let T=Math.min(t-1,o),C=Math.max(0,Math.min(o-2,t)),V=Math.max(T,C);for(let g=0;g<V;g++){if(g<T){m[g]=0;for(let x=g;x<t;x++)m[g]=pt(m[g],c.get(x,g));if(m[g]!==0){c.get(g,g)<0&&(m[g]=-m[g]);for(let x=g;x<t;x++)c.set(x,g,c.get(x,g)/m[g]);c.set(g,g,c.get(g,g)+1)}m[g]=-m[g]}for(let x=g+1;x<o;x++){if(g<T&&m[g]!==0){let M=0;for(let j=g;j<t;j++)M+=c.get(j,g)*c.get(j,x);M=-M/c.get(g,g);for(let j=g;j<t;j++)c.set(j,x,c.get(j,x)+M*c.get(j,g))}f[x]=c.get(g,x)}if(a&&g<T)for(let x=g;x<t;x++)p.set(x,g,c.get(x,g));if(g<C){f[g]=0;for(let x=g+1;x<o;x++)f[g]=pt(f[g],f[x]);if(f[g]!==0){f[g+1]<0&&(f[g]=0-f[g]);for(let x=g+1;x<o;x++)f[x]/=f[g];f[g+1]+=1}if(f[g]=-f[g],g+1<t&&f[g]!==0){for(let x=g+1;x<t;x++)E[x]=0;for(let x=g+1;x<t;x++)for(let M=g+1;M<o;M++)E[x]+=f[M]*c.get(x,M);for(let x=g+1;x<o;x++){let M=-f[x]/f[g+1];for(let j=g+1;j<t;j++)c.set(j,x,c.get(j,x)+M*E[j])}}if(h)for(let x=g+1;x<o;x++)S.set(x,g,f[x])}}let P=Math.min(o,t+1);if(T<o&&(m[T]=c.get(T,T)),t<P&&(m[P-1]=0),C+1<P&&(f[C]=c.get(C,P-1)),f[P-1]=0,a){for(let g=T;g<w;g++){for(let x=0;x<t;x++)p.set(x,g,0);p.set(g,g,1)}for(let g=T-1;g>=0;g--)if(m[g]!==0){for(let x=g+1;x<w;x++){let M=0;for(let j=g;j<t;j++)M+=p.get(j,g)*p.get(j,x);M=-M/p.get(g,g);for(let j=g;j<t;j++)p.set(j,x,p.get(j,x)+M*p.get(j,g))}for(let x=g;x<t;x++)p.set(x,g,-p.get(x,g));p.set(g,g,1+p.get(g,g));for(let x=0;x<g-1;x++)p.set(x,g,0)}else{for(let x=0;x<t;x++)p.set(x,g,0);p.set(g,g,1)}}if(h)for(let g=o-1;g>=0;g--){if(g<C&&f[g]!==0)for(let x=g+1;x<o;x++){let M=0;for(let j=g+1;j<o;j++)M+=S.get(j,g)*S.get(j,x);M=-M/S.get(g+1,g);for(let j=g+1;j<o;j++)S.set(j,x,S.get(j,x)+M*S.get(j,g))}for(let x=0;x<o;x++)S.set(x,g,0);S.set(g,g,1)}let B=P-1,N=Number.EPSILON;for(;P>0;){let g,x;for(g=P-2;g>=-1&&g!==-1;g--){const M=Number.MIN_VALUE+N*Math.abs(m[g]+Math.abs(m[g+1]));if(Math.abs(f[g])<=M||Number.isNaN(f[g])){f[g]=0;break}}if(g===P-2)x=4;else{let M;for(M=P-1;M>=g&&M!==g;M--){let j=(M!==P?Math.abs(f[M]):0)+(M!==g+1?Math.abs(f[M-1]):0);if(Math.abs(m[M])<=N*j){m[M]=0;break}}M===g?x=3:M===P-1?x=1:(x=2,g=M)}switch(g++,x){case 1:{let M=f[P-2];f[P-2]=0;for(let j=P-2;j>=g;j--){let Y=pt(m[j],M),z=m[j]/Y,$=M/Y;if(m[j]=Y,j!==g&&(M=-$*f[j-1],f[j-1]=z*f[j-1]),h)for(let q=0;q<o;q++)Y=z*S.get(q,j)+$*S.get(q,P-1),S.set(q,P-1,-$*S.get(q,j)+z*S.get(q,P-1)),S.set(q,j,Y)}break}case 2:{let M=f[g-1];f[g-1]=0;for(let j=g;j<P;j++){let Y=pt(m[j],M),z=m[j]/Y,$=M/Y;if(m[j]=Y,M=-$*f[j],f[j]=z*f[j],a)for(let q=0;q<t;q++)Y=z*p.get(q,j)+$*p.get(q,g-1),p.set(q,g-1,-$*p.get(q,j)+z*p.get(q,g-1)),p.set(q,j,Y)}break}case 3:{const M=Math.max(Math.abs(m[P-1]),Math.abs(m[P-2]),Math.abs(f[P-2]),Math.abs(m[g]),Math.abs(f[g])),j=m[P-1]/M,Y=m[P-2]/M,z=f[P-2]/M,$=m[g]/M,q=f[g]/M,J=((Y+j)*(Y-j)+z*z)/2,Q=j*z*(j*z);let A=0;(J!==0||Q!==0)&&(J<0?A=0-Math.sqrt(J*J+Q):A=Math.sqrt(J*J+Q),A=Q/(J+A));let et=($+j)*($-j)+A,st=$*q;for(let O=g;O<P-1;O++){let G=pt(et,st);G===0&&(G=Number.MIN_VALUE);let Z=et/G,y=st/G;if(O!==g&&(f[O-1]=G),et=Z*m[O]+y*f[O],f[O]=Z*f[O]-y*m[O],st=y*m[O+1],m[O+1]=Z*m[O+1],h)for(let b=0;b<o;b++)G=Z*S.get(b,O)+y*S.get(b,O+1),S.set(b,O+1,-y*S.get(b,O)+Z*S.get(b,O+1)),S.set(b,O,G);if(G=pt(et,st),G===0&&(G=Number.MIN_VALUE),Z=et/G,y=st/G,m[O]=G,et=Z*f[O]+y*m[O+1],m[O+1]=-y*f[O]+Z*m[O+1],st=y*f[O+1],f[O+1]=Z*f[O+1],a&&O<t-1)for(let b=0;b<t;b++)G=Z*p.get(b,O)+y*p.get(b,O+1),p.set(b,O+1,-y*p.get(b,O)+Z*p.get(b,O+1)),p.set(b,O,G)}f[P-2]=et;break}case 4:{if(m[g]<=0&&(m[g]=m[g]<0?-m[g]:0,h))for(let M=0;M<=B;M++)S.set(M,g,-S.get(M,g));for(;g<B&&!(m[g]>=m[g+1]);){let M=m[g];if(m[g]=m[g+1],m[g+1]=M,h&&g<o-1)for(let j=0;j<o;j++)M=S.get(j,g+1),S.set(j,g+1,S.get(j,g)),S.set(j,g,M);if(a&&g<t-1)for(let j=0;j<t;j++)M=p.get(j,g+1),p.set(j,g+1,p.get(j,g)),p.set(j,g,M);g++}P--;break}}}if(u){let g=S;S=p,p=g}this.m=t,this.n=o,this.s=m,this.U=p,this.V=S}solve(s){let e=s,t=this.threshold,o=this.s.length,n=R.zeros(o,o);for(let w=0;w<o;w++)Math.abs(this.s[w])<=t?n.set(w,w,0):n.set(w,w,1/this.s[w]);let r=this.U,l=this.rightSingularVectors,a=l.mmul(n),h=l.rows,u=r.rows,c=R.zeros(h,u);for(let w=0;w<h;w++)for(let v=0;v<u;v++){let m=0;for(let p=0;p<o;p++)m+=a.get(w,p)*r.get(v,p);c.set(w,v,m)}return c.mmul(e)}solveForDiagonal(s){return this.solve(R.diag(s))}inverse(){let s=this.V,e=this.threshold,t=s.rows,o=s.columns,n=new R(t,this.s.length);for(let u=0;u<t;u++)for(let c=0;c<o;c++)Math.abs(this.s[c])>e&&n.set(u,c,s.get(u,c)/this.s[c]);let r=this.U,l=r.rows,a=r.columns,h=new R(t,l);for(let u=0;u<t;u++)for(let c=0;c<l;c++){let w=0;for(let v=0;v<a;v++)w+=n.get(u,v)*r.get(c,v);h.set(u,c,w)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let s=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let o=0,n=t.length;o<n;o++)t[o]>s&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return R.diag(this.s)}}function ds(i,s=!1){return i=at.checkMatrix(i),s?new Bt(i).inverse():be(i,R.eye(i.rows))}function be(i,s,e=!1){return i=at.checkMatrix(i),s=at.checkMatrix(s),e?new Bt(i).solve(s):i.isSquare()?new Ut(i).solve(s):new ne(i).solve(s)}function Ot(i){if(i=R.checkMatrix(i),i.isSquare()){if(i.columns===0)return 1;let s,e,t,o;if(i.columns===2)return s=i.get(0,0),e=i.get(0,1),t=i.get(1,0),o=i.get(1,1),s*o-e*t;if(i.columns===3){let n,r,l;return n=new qt(i,[1,2],[1,2]),r=new qt(i,[1,2],[0,2]),l=new qt(i,[1,2],[0,1]),s=i.get(0,0),e=i.get(0,1),t=i.get(0,2),s*Ot(n)-e*Ot(r)+t*Ot(l)}else return new Ut(i).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ms(i,s){let e=[];for(let t=0;t<i;t++)t!==s&&e.push(t);return e}function ps(i,s,e,t=1e-9,o=1e-9){if(i>o)return new Array(s.rows+1).fill(0);{let n=s.addRow(e,[0]);for(let r=0;r<n.rows;r++)Math.abs(n.get(r,0))<t&&n.set(r,0,0);return n.to1DArray()}}function ws(i,s={}){const{thresholdValue:e=1e-9,thresholdError:t=1e-9}=s;i=R.checkMatrix(i);let o=i.rows,n=new R(o,o);for(let r=0;r<o;r++){let l=R.columnVector(i.getRow(r)),a=i.subMatrixRow(ms(o,r)).transpose(),u=new Bt(a).solve(l),c=R.sub(l,a.mmul(u)).abs().max();n.setRow(r,ps(c,u,r,e,t))}return n}function ys(i,s=Number.EPSILON){if(i=R.checkMatrix(i),i.isEmpty())return i.transpose();let e=new Bt(i,{autoTranspose:!0}),t=e.leftSingularVectors,o=e.rightSingularVectors,n=e.diagonal;for(let r=0;r<n.length;r++)Math.abs(n[r])>s?n[r]=1/n[r]:n[r]=0;return o.mmul(R.diag(n).mmul(t.transpose()))}function vs(i,s=i,e={}){i=new R(i);let t=!1;if(typeof s=="object"&&!R.isMatrix(s)&&!lt.isAnyArray(s)?(e=s,s=i,t=!0):s=new R(s),i.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=e;o&&(i=i.center("column"),t||(s=s.center("column")));const n=i.transpose().mmul(s);for(let r=0;r<n.rows;r++)for(let l=0;l<n.columns;l++)n.set(r,l,n.get(r,l)*(1/(i.rows-1)));return n}function bs(i,s=i,e={}){i=new R(i);let t=!1;if(typeof s=="object"&&!R.isMatrix(s)&&!lt.isAnyArray(s)?(e=s,s=i,t=!0):s=new R(s),i.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:n=!0}=e;o&&(i.center("column"),t||s.center("column")),n&&(i.scale("column"),t||s.scale("column"));const r=i.standardDeviation("column",{unbiased:!0}),l=t?r:s.standardDeviation("column",{unbiased:!0}),a=i.transpose().mmul(s);for(let h=0;h<a.rows;h++)for(let u=0;u<a.columns;u++)a.set(h,u,a.get(h,u)*(1/(r[h]*l[u]))*(1/(i.rows-1)));return a}class xe{constructor(s,e={}){const{assumeSymmetric:t=!1}=e;if(s=at.checkMatrix(s),!s.isSquare())throw new Error("Matrix is not a square matrix");if(s.isEmpty())throw new Error("Matrix must be non-empty");let o=s.columns,n=new R(o,o),r=new Float64Array(o),l=new Float64Array(o),a=s,h,u,c=!1;if(t?c=!0:c=s.isSymmetric(),c){for(h=0;h<o;h++)for(u=0;u<o;u++)n.set(h,u,a.get(h,u));xs(o,l,r,n),Ss(o,l,r,n)}else{let w=new R(o,o),v=new Float64Array(o);for(u=0;u<o;u++)for(h=0;h<o;h++)w.set(h,u,a.get(h,u));Es(o,w,v,n),js(o,l,r,n,w)}this.n=o,this.e=l,this.d=r,this.V=n}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let s=this.n,e=this.e,t=this.d,o=new R(s,s),n,r;for(n=0;n<s;n++){for(r=0;r<s;r++)o.set(n,r,0);o.set(n,n,t[n]),e[n]>0?o.set(n,n+1,e[n]):e[n]<0&&o.set(n,n-1,e[n])}return o}}function xs(i,s,e,t){let o,n,r,l,a,h,u,c;for(a=0;a<i;a++)e[a]=t.get(i-1,a);for(l=i-1;l>0;l--){for(c=0,r=0,h=0;h<l;h++)c=c+Math.abs(e[h]);if(c===0)for(s[l]=e[l-1],a=0;a<l;a++)e[a]=t.get(l-1,a),t.set(l,a,0),t.set(a,l,0);else{for(h=0;h<l;h++)e[h]/=c,r+=e[h]*e[h];for(o=e[l-1],n=Math.sqrt(r),o>0&&(n=-n),s[l]=c*n,r=r-o*n,e[l-1]=o-n,a=0;a<l;a++)s[a]=0;for(a=0;a<l;a++){for(o=e[a],t.set(a,l,o),n=s[a]+t.get(a,a)*o,h=a+1;h<=l-1;h++)n+=t.get(h,a)*e[h],s[h]+=t.get(h,a)*o;s[a]=n}for(o=0,a=0;a<l;a++)s[a]/=r,o+=s[a]*e[a];for(u=o/(r+r),a=0;a<l;a++)s[a]-=u*e[a];for(a=0;a<l;a++){for(o=e[a],n=s[a],h=a;h<=l-1;h++)t.set(h,a,t.get(h,a)-(o*s[h]+n*e[h]));e[a]=t.get(l-1,a),t.set(l,a,0)}}e[l]=r}for(l=0;l<i-1;l++){if(t.set(i-1,l,t.get(l,l)),t.set(l,l,1),r=e[l+1],r!==0){for(h=0;h<=l;h++)e[h]=t.get(h,l+1)/r;for(a=0;a<=l;a++){for(n=0,h=0;h<=l;h++)n+=t.get(h,l+1)*t.get(h,a);for(h=0;h<=l;h++)t.set(h,a,t.get(h,a)-n*e[h])}}for(h=0;h<=l;h++)t.set(h,l+1,0)}for(a=0;a<i;a++)e[a]=t.get(i-1,a),t.set(i-1,a,0);t.set(i-1,i-1,1),s[0]=0}function Ss(i,s,e,t){let o,n,r,l,a,h,u,c,w,v,m,p,S,f,E,k;for(r=1;r<i;r++)s[r-1]=s[r];s[i-1]=0;let T=0,C=0,V=Number.EPSILON;for(h=0;h<i;h++){for(C=Math.max(C,Math.abs(e[h])+Math.abs(s[h])),u=h;u<i&&!(Math.abs(s[u])<=V*C);)u++;if(u>h)do{for(o=e[h],c=(e[h+1]-o)/(2*s[h]),w=pt(c,1),c<0&&(w=-w),e[h]=s[h]/(c+w),e[h+1]=s[h]*(c+w),v=e[h+1],n=o-e[h],r=h+2;r<i;r++)e[r]-=n;for(T=T+n,c=e[u],m=1,p=m,S=m,f=s[h+1],E=0,k=0,r=u-1;r>=h;r--)for(S=p,p=m,k=E,o=m*s[r],n=m*c,w=pt(c,s[r]),s[r+1]=E*w,E=s[r]/w,m=c/w,c=m*e[r]-E*o,e[r+1]=n+E*(m*o+E*e[r]),a=0;a<i;a++)n=t.get(a,r+1),t.set(a,r+1,E*t.get(a,r)+m*n),t.set(a,r,m*t.get(a,r)-E*n);c=-E*k*S*f*s[h]/v,s[h]=E*c,e[h]=m*c}while(Math.abs(s[h])>V*C);e[h]=e[h]+T,s[h]=0}for(r=0;r<i-1;r++){for(a=r,c=e[r],l=r+1;l<i;l++)e[l]<c&&(a=l,c=e[l]);if(a!==r)for(e[a]=e[r],e[r]=c,l=0;l<i;l++)c=t.get(l,r),t.set(l,r,t.get(l,a)),t.set(l,a,c)}}function Es(i,s,e,t){let o=0,n=i-1,r,l,a,h,u,c,w;for(c=o+1;c<=n-1;c++){for(w=0,h=c;h<=n;h++)w=w+Math.abs(s.get(h,c-1));if(w!==0){for(a=0,h=n;h>=c;h--)e[h]=s.get(h,c-1)/w,a+=e[h]*e[h];for(l=Math.sqrt(a),e[c]>0&&(l=-l),a=a-e[c]*l,e[c]=e[c]-l,u=c;u<i;u++){for(r=0,h=n;h>=c;h--)r+=e[h]*s.get(h,u);for(r=r/a,h=c;h<=n;h++)s.set(h,u,s.get(h,u)-r*e[h])}for(h=0;h<=n;h++){for(r=0,u=n;u>=c;u--)r+=e[u]*s.get(h,u);for(r=r/a,u=c;u<=n;u++)s.set(h,u,s.get(h,u)-r*e[u])}e[c]=w*e[c],s.set(c,c-1,w*l)}}for(h=0;h<i;h++)for(u=0;u<i;u++)t.set(h,u,h===u?1:0);for(c=n-1;c>=o+1;c--)if(s.get(c,c-1)!==0){for(h=c+1;h<=n;h++)e[h]=s.get(h,c-1);for(u=c;u<=n;u++){for(l=0,h=c;h<=n;h++)l+=e[h]*t.get(h,u);for(l=l/e[c]/s.get(c,c-1),h=c;h<=n;h++)t.set(h,u,t.get(h,u)+l*e[h])}}}function js(i,s,e,t,o){let n=i-1,r=0,l=i-1,a=Number.EPSILON,h=0,u=0,c=0,w=0,v=0,m=0,p=0,S=0,f,E,k,T,C,V,P,B,N,g,x,M,j,Y,z;for(f=0;f<i;f++)for((f<r||f>l)&&(e[f]=o.get(f,f),s[f]=0),E=Math.max(f-1,0);E<i;E++)u=u+Math.abs(o.get(f,E));for(;n>=r;){for(T=n;T>r&&(m=Math.abs(o.get(T-1,T-1))+Math.abs(o.get(T,T)),m===0&&(m=u),!(Math.abs(o.get(T,T-1))<a*m));)T--;if(T===n)o.set(n,n,o.get(n,n)+h),e[n]=o.get(n,n),s[n]=0,n--,S=0;else if(T===n-1){if(P=o.get(n,n-1)*o.get(n-1,n),c=(o.get(n-1,n-1)-o.get(n,n))/2,w=c*c+P,p=Math.sqrt(Math.abs(w)),o.set(n,n,o.get(n,n)+h),o.set(n-1,n-1,o.get(n-1,n-1)+h),B=o.get(n,n),w>=0){for(p=c>=0?c+p:c-p,e[n-1]=B+p,e[n]=e[n-1],p!==0&&(e[n]=B-P/p),s[n-1]=0,s[n]=0,B=o.get(n,n-1),m=Math.abs(B)+Math.abs(p),c=B/m,w=p/m,v=Math.sqrt(c*c+w*w),c=c/v,w=w/v,E=n-1;E<i;E++)p=o.get(n-1,E),o.set(n-1,E,w*p+c*o.get(n,E)),o.set(n,E,w*o.get(n,E)-c*p);for(f=0;f<=n;f++)p=o.get(f,n-1),o.set(f,n-1,w*p+c*o.get(f,n)),o.set(f,n,w*o.get(f,n)-c*p);for(f=r;f<=l;f++)p=t.get(f,n-1),t.set(f,n-1,w*p+c*t.get(f,n)),t.set(f,n,w*t.get(f,n)-c*p)}else e[n-1]=B+c,e[n]=B+c,s[n-1]=p,s[n]=-p;n=n-2,S=0}else{if(B=o.get(n,n),N=0,P=0,T<n&&(N=o.get(n-1,n-1),P=o.get(n,n-1)*o.get(n-1,n)),S===10){for(h+=B,f=r;f<=n;f++)o.set(f,f,o.get(f,f)-B);m=Math.abs(o.get(n,n-1))+Math.abs(o.get(n-1,n-2)),B=N=.75*m,P=-.4375*m*m}if(S===30&&(m=(N-B)/2,m=m*m+P,m>0)){for(m=Math.sqrt(m),N<B&&(m=-m),m=B-P/((N-B)/2+m),f=r;f<=n;f++)o.set(f,f,o.get(f,f)-m);h+=m,B=N=P=.964}for(S=S+1,C=n-2;C>=T&&(p=o.get(C,C),v=B-p,m=N-p,c=(v*m-P)/o.get(C+1,C)+o.get(C,C+1),w=o.get(C+1,C+1)-p-v-m,v=o.get(C+2,C+1),m=Math.abs(c)+Math.abs(w)+Math.abs(v),c=c/m,w=w/m,v=v/m,!(C===T||Math.abs(o.get(C,C-1))*(Math.abs(w)+Math.abs(v))<a*(Math.abs(c)*(Math.abs(o.get(C-1,C-1))+Math.abs(p)+Math.abs(o.get(C+1,C+1))))));)C--;for(f=C+2;f<=n;f++)o.set(f,f-2,0),f>C+2&&o.set(f,f-3,0);for(k=C;k<=n-1&&(Y=k!==n-1,k!==C&&(c=o.get(k,k-1),w=o.get(k+1,k-1),v=Y?o.get(k+2,k-1):0,B=Math.abs(c)+Math.abs(w)+Math.abs(v),B!==0&&(c=c/B,w=w/B,v=v/B)),B!==0);k++)if(m=Math.sqrt(c*c+w*w+v*v),c<0&&(m=-m),m!==0){for(k!==C?o.set(k,k-1,-m*B):T!==C&&o.set(k,k-1,-o.get(k,k-1)),c=c+m,B=c/m,N=w/m,p=v/m,w=w/c,v=v/c,E=k;E<i;E++)c=o.get(k,E)+w*o.get(k+1,E),Y&&(c=c+v*o.get(k+2,E),o.set(k+2,E,o.get(k+2,E)-c*p)),o.set(k,E,o.get(k,E)-c*B),o.set(k+1,E,o.get(k+1,E)-c*N);for(f=0;f<=Math.min(n,k+3);f++)c=B*o.get(f,k)+N*o.get(f,k+1),Y&&(c=c+p*o.get(f,k+2),o.set(f,k+2,o.get(f,k+2)-c*v)),o.set(f,k,o.get(f,k)-c),o.set(f,k+1,o.get(f,k+1)-c*w);for(f=r;f<=l;f++)c=B*t.get(f,k)+N*t.get(f,k+1),Y&&(c=c+p*t.get(f,k+2),t.set(f,k+2,t.get(f,k+2)-c*v)),t.set(f,k,t.get(f,k)-c),t.set(f,k+1,t.get(f,k+1)-c*w)}}}if(u!==0){for(n=i-1;n>=0;n--)if(c=e[n],w=s[n],w===0)for(T=n,o.set(n,n,1),f=n-1;f>=0;f--){for(P=o.get(f,f)-c,v=0,E=T;E<=n;E++)v=v+o.get(f,E)*o.get(E,n);if(s[f]<0)p=P,m=v;else if(T=f,s[f]===0?o.set(f,n,P!==0?-v/P:-v/(a*u)):(B=o.get(f,f+1),N=o.get(f+1,f),w=(e[f]-c)*(e[f]-c)+s[f]*s[f],V=(B*m-p*v)/w,o.set(f,n,V),o.set(f+1,n,Math.abs(B)>Math.abs(p)?(-v-P*V)/B:(-m-N*V)/p)),V=Math.abs(o.get(f,n)),a*V*V>1)for(E=f;E<=n;E++)o.set(E,n,o.get(E,n)/V)}else if(w<0)for(T=n-1,Math.abs(o.get(n,n-1))>Math.abs(o.get(n-1,n))?(o.set(n-1,n-1,w/o.get(n,n-1)),o.set(n-1,n,-(o.get(n,n)-c)/o.get(n,n-1))):(z=Lt(0,-o.get(n-1,n),o.get(n-1,n-1)-c,w),o.set(n-1,n-1,z[0]),o.set(n-1,n,z[1])),o.set(n,n-1,0),o.set(n,n,1),f=n-2;f>=0;f--){for(g=0,x=0,E=T;E<=n;E++)g=g+o.get(f,E)*o.get(E,n-1),x=x+o.get(f,E)*o.get(E,n);if(P=o.get(f,f)-c,s[f]<0)p=P,v=g,m=x;else if(T=f,s[f]===0?(z=Lt(-g,-x,P,w),o.set(f,n-1,z[0]),o.set(f,n,z[1])):(B=o.get(f,f+1),N=o.get(f+1,f),M=(e[f]-c)*(e[f]-c)+s[f]*s[f]-w*w,j=(e[f]-c)*2*w,M===0&&j===0&&(M=a*u*(Math.abs(P)+Math.abs(w)+Math.abs(B)+Math.abs(N)+Math.abs(p))),z=Lt(B*v-p*g+w*x,B*m-p*x-w*g,M,j),o.set(f,n-1,z[0]),o.set(f,n,z[1]),Math.abs(B)>Math.abs(p)+Math.abs(w)?(o.set(f+1,n-1,(-g-P*o.get(f,n-1)+w*o.get(f,n))/B),o.set(f+1,n,(-x-P*o.get(f,n)-w*o.get(f,n-1))/B)):(z=Lt(-v-N*o.get(f,n-1),-m-N*o.get(f,n),p,w),o.set(f+1,n-1,z[0]),o.set(f+1,n,z[1]))),V=Math.max(Math.abs(o.get(f,n-1)),Math.abs(o.get(f,n))),a*V*V>1)for(E=f;E<=n;E++)o.set(E,n-1,o.get(E,n-1)/V),o.set(E,n,o.get(E,n)/V)}for(f=0;f<i;f++)if(f<r||f>l)for(E=f;E<i;E++)t.set(f,E,o.get(f,E));for(E=i-1;E>=r;E--)for(f=r;f<=l;f++){for(p=0,k=r;k<=Math.min(E,l);k++)p=p+t.get(f,k)*o.get(k,E);t.set(f,E,p)}}}function Lt(i,s,e,t){let o,n;return Math.abs(e)>Math.abs(t)?(o=t/e,n=e+o*t,[(i+o*s)/n,(s-o*i)/n]):(o=e/t,n=t+o*e,[(o*i+s)/n,(o*s-i)/n])}class Se{constructor(s){if(s=at.checkMatrix(s),!s.isSymmetric())throw new Error("Matrix is not symmetric");let e=s,t=e.rows,o=new R(t,t),n=!0,r,l,a;for(l=0;l<t;l++){let h=0;for(a=0;a<l;a++){let u=0;for(r=0;r<a;r++)u+=o.get(a,r)*o.get(l,r);u=(e.get(l,a)-u)/o.get(a,a),o.set(l,a,u),h=h+u*u}for(h=e.get(l,l)-h,n&&(n=h>0),o.set(l,l,Math.sqrt(Math.max(h,0))),a=l+1;a<t;a++)o.set(l,a,0)}this.L=o,this.positiveDefinite=n}isPositiveDefinite(){return this.positiveDefinite}solve(s){s=at.checkMatrix(s);let e=this.L,t=e.rows;if(s.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=s.columns,n=s.clone(),r,l,a;for(a=0;a<t;a++)for(l=0;l<o;l++){for(r=0;r<a;r++)n.set(a,l,n.get(a,l)-n.get(r,l)*e.get(a,r));n.set(a,l,n.get(a,l)/e.get(a,a))}for(a=t-1;a>=0;a--)for(l=0;l<o;l++){for(r=a+1;r<t;r++)n.set(a,l,n.get(a,l)-n.get(r,l)*e.get(r,a));n.set(a,l,n.get(a,l)/e.get(a,a))}return n}get lowerTriangularMatrix(){return this.L}}class Ee{constructor(s,e={}){s=at.checkMatrix(s);let{Y:t}=e;const{scaleScores:o=!1,maxIterations:n=1e3,terminationCriteria:r=1e-10}=e;let l;if(t){if(lt.isAnyArray(t)&&typeof t[0]=="number"?t=R.columnVector(t):t=at.checkMatrix(t),t.rows!==s.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=s.getColumnVector(0);let a=1,h,u,c,w;for(let v=0;v<n&&a>r;v++)c=s.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),c=c.div(c.norm()),h=s.mmul(c).div(c.transpose().mmul(c).get(0,0)),v>0&&(a=h.clone().sub(w).pow(2).sum()),w=h.clone(),t?(u=t.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),u=u.div(u.norm()),l=t.mmul(u).div(u.transpose().mmul(u).get(0,0))):l=h;if(t){let v=s.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));v=v.div(v.norm());let m=s.clone().sub(h.clone().mmul(v.transpose())),p=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),S=t.clone().sub(h.clone().mulS(p.get(0,0)).mmul(u.transpose()));this.t=h,this.p=v.transpose(),this.w=c.transpose(),this.q=u,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=m,this.yResidual=S,this.betas=p}else this.w=c.transpose(),this.s=h.transpose().mmul(h).sqrt(),o?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=s.sub(h.mmul(c.transpose()))}}U.AbstractMatrix=W;U.CHO=Se;U.CholeskyDecomposition=Se;U.DistanceMatrix=At;U.EVD=xe;U.EigenvalueDecomposition=xe;U.LU=Ut;U.LuDecomposition=Ut;var je=U.Matrix=R;U.MatrixColumnSelectionView=rs;U.MatrixColumnView=is;U.MatrixFlipColumnView=ls;U.MatrixFlipRowView=cs;U.MatrixRowSelectionView=as;U.MatrixRowView=hs;U.MatrixSelectionView=qt;U.MatrixSubView=us;U.MatrixTransposeView=fs;U.NIPALS=Ee;U.Nipals=Ee;U.QR=ne;U.QrDecomposition=ne;U.SVD=Bt;U.SingularValueDecomposition=Bt;U.SymmetricMatrix=St;U.WrapperMatrix1D=ve;U.WrapperMatrix2D=at;U.correlation=bs;U.covariance=vs;var ae=U.default=R;U.determinant=Ot;U.inverse=ds;U.linearDependencies=ws;U.pseudoInverse=ys;var Is=U.solve=be;U.wrap=gs;const K=je;ae.Matrix&&ae.Matrix;const kt=Is;var Ms={};(function(i){(function(){var s={not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function e(l){return o(r(l),arguments)}function t(l,a){return e.apply(null,[l].concat(a||[]))}function o(l,a){var h=1,u=l.length,c,w="",v,m,p,S,f,E,k,T;for(v=0;v<u;v++)if(typeof l[v]=="string")w+=l[v];else if(typeof l[v]=="object"){if(p=l[v],p.keys)for(c=a[h],m=0;m<p.keys.length;m++){if(c==null)throw new Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',p.keys[m],p.keys[m-1]));c=c[p.keys[m]]}else p.param_no?c=a[p.param_no]:c=a[h++];if(s.not_type.test(p.type)&&s.not_primitive.test(p.type)&&c instanceof Function&&(c=c()),s.numeric_arg.test(p.type)&&typeof c!="number"&&isNaN(c))throw new TypeError(e("[sprintf] expecting number but found %T",c));switch(s.number.test(p.type)&&(k=c>=0),p.type){case"b":c=parseInt(c,10).toString(2);break;case"c":c=String.fromCharCode(parseInt(c,10));break;case"d":case"i":c=parseInt(c,10);break;case"j":c=JSON.stringify(c,null,p.width?parseInt(p.width):0);break;case"e":c=p.precision?parseFloat(c).toExponential(p.precision):parseFloat(c).toExponential();break;case"f":c=p.precision?parseFloat(c).toFixed(p.precision):parseFloat(c);break;case"g":c=p.precision?String(Number(c.toPrecision(p.precision))):parseFloat(c);break;case"o":c=(parseInt(c,10)>>>0).toString(8);break;case"s":c=String(c),c=p.precision?c.substring(0,p.precision):c;break;case"t":c=String(!!c),c=p.precision?c.substring(0,p.precision):c;break;case"T":c=Object.prototype.toString.call(c).slice(8,-1).toLowerCase(),c=p.precision?c.substring(0,p.precision):c;break;case"u":c=parseInt(c,10)>>>0;break;case"v":c=c.valueOf(),c=p.precision?c.substring(0,p.precision):c;break;case"x":c=(parseInt(c,10)>>>0).toString(16);break;case"X":c=(parseInt(c,10)>>>0).toString(16).toUpperCase();break}s.json.test(p.type)?w+=c:(s.number.test(p.type)&&(!k||p.sign)?(T=k?"+":"-",c=c.toString().replace(s.sign,"")):T="",f=p.pad_char?p.pad_char==="0"?"0":p.pad_char.charAt(1):" ",E=p.width-(T+c).length,S=p.width&&E>0?f.repeat(E):"",w+=p.align?T+c+S:f==="0"?T+S+c:S+T+c)}return w}var n=Object.create(null);function r(l){if(n[l])return n[l];for(var a=l,h,u=[],c=0;a;){if((h=s.text.exec(a))!==null)u.push(h[0]);else if((h=s.modulo.exec(a))!==null)u.push("%");else if((h=s.placeholder.exec(a))!==null){if(h[2]){c|=1;var w=[],v=h[2],m=[];if((m=s.key.exec(v))!==null)for(w.push(m[1]);(v=v.substring(m[0].length))!=="";)if((m=s.key_access.exec(v))!==null)w.push(m[1]);else if((m=s.index_access.exec(v))!==null)w.push(m[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");h[2]=w}else c|=2;if(c===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:h[0],param_no:h[1],keys:h[2],sign:h[3],pad_char:h[4],align:h[5],width:h[6],precision:h[7],type:h[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");a=a.substring(h[0].length)}return n[l]=u}i.sprintf=e,i.vsprintf=t,typeof window<"u"&&(window.sprintf=e,window.vsprintf=t)})()})(Ms);const d={vertices:[],currentMouse:null,polygonComplete:!1,interiorPoint:null,objectiveVector:null,currentObjective:null,computedVertices:[],computedLines:[],snapToGrid:!1,highlightIndex:null,analyticCenter:null,iteratePath:[],iteratePathComputed:!1,historyStack:[],redoStack:[],highlightIteratePathIndex:null,isIteratePathComputing:!1,rotateObjectiveMode:!1,barrierWeightsVisible:!1,draggingPointIndex:null,draggingObjective:!1,barrierWeights:[],solverMode:"central",animationIntervalId:null,originalIteratePath:[],isPanning:!1,lastPan:{x:0,y:0},wasPanning:!1};class ks{constructor(s){this.canvas=s,this.ctx=s.getContext("2d"),this.gridSpacing=20,this.scaleFactor=1,this.offset={x:0,y:0},this.centerX=window.innerWidth/2,this.centerY=window.innerHeight/2}updateDimensions(){const s=window.devicePixelRatio||1;this.canvas.width=window.innerWidth*s,this.canvas.height=window.innerHeight*s,this.canvas.style.width=`${window.innerWidth}px`,this.canvas.style.height=`${window.innerHeight}px`,this.ctx.setTransform(s,0,0,s,0,0);const e=document.getElementById("sidebar").offsetWidth;this.centerX=e+(window.innerWidth-e)/2,this.centerY=window.innerHeight/2}toLogicalCoords(s,e){let t={x:(s-this.centerX)/(this.gridSpacing*this.scaleFactor)-this.offset.x,y:(this.centerY-e)/(this.gridSpacing*this.scaleFactor)-this.offset.y};return d.snapToGrid&&(t.x=Math.round(t.x),t.y=Math.round(t.y)),t}toCanvasCoords(s,e){return{x:this.centerX+(s+this.offset.x)*this.gridSpacing*this.scaleFactor,y:this.centerY-(e+this.offset.y)*this.gridSpacing*this.scaleFactor}}drawGrid(){const s=window.innerWidth,e=window.innerHeight,t=this.centerX+this.offset.x*this.gridSpacing*this.scaleFactor,o=this.centerY-this.offset.y*this.gridSpacing*this.scaleFactor;this.ctx.strokeStyle="#e0e0e0",this.ctx.lineWidth=.5;for(let n=t;n<=s;n+=this.gridSpacing*this.scaleFactor)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,e),this.ctx.stroke();for(let n=t;n>=0;n-=this.gridSpacing*this.scaleFactor)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,e),this.ctx.stroke();for(let n=o;n<=e;n+=this.gridSpacing*this.scaleFactor)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(s,n),this.ctx.stroke();for(let n=o;n>=0;n-=this.gridSpacing*this.scaleFactor)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(s,n),this.ctx.stroke();this.ctx.strokeStyle="#707070",this.ctx.lineWidth=.8,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,e),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,o),this.ctx.lineTo(s,o),this.ctx.stroke()}drawPolygon(){if(d.vertices.length!==0)if(d.polygonComplete){if(d.vertices.forEach((s,e)=>{const t=this.toCanvasCoords(s.x,s.y),o=this.toCanvasCoords(d.vertices[(e+1)%d.vertices.length].x,d.vertices[(e+1)%d.vertices.length].y);this.ctx.beginPath(),this.ctx.strokeStyle=d.highlightIndex===e?"red":"black",this.ctx.lineWidth=d.highlightIndex===e?4:2,this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(o.x,o.y),this.ctx.stroke()}),d.vertices.forEach(s=>{const e=this.toCanvasCoords(s.x,s.y);this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,4,0,2*Math.PI),this.ctx.fill()}),!this.isPolygonConvex(d.vertices)){this.ctx.fillStyle="rgba(255, 0, 0, 0.3)",this.ctx.beginPath();const s=this.toCanvasCoords(d.vertices[0].x,d.vertices[0].y);this.ctx.moveTo(s.x,s.y);for(let e=1;e<d.vertices.length;e++){const t=this.toCanvasCoords(d.vertices[e].x,d.vertices[e].y);this.ctx.lineTo(t.x,t.y)}this.ctx.closePath(),this.ctx.fill()}}else{this.ctx.beginPath();const s=this.toCanvasCoords(d.vertices[0].x,d.vertices[0].y);this.ctx.moveTo(s.x,s.y);for(let e=1;e<d.vertices.length;e++){const t=this.toCanvasCoords(d.vertices[e].x,d.vertices[e].y);this.ctx.lineTo(t.x,t.y)}if(d.currentMouse){const e=this.toCanvasCoords(d.currentMouse.x,d.currentMouse.y);this.ctx.lineTo(e.x,e.y)}this.ctx.strokeStyle="black",this.ctx.lineWidth=2,this.ctx.stroke(),d.vertices.forEach(e=>{const t=this.toCanvasCoords(e.x,e.y);this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,4,0,2*Math.PI),this.ctx.fill()})}}drawAnalyticCenter(){}drawObjective(){const s=d.objectiveVector||(d.polygonComplete&&d.currentObjective?d.currentObjective:null);if(s){const e=this.toCanvasCoords(0,0),t=this.toCanvasCoords(s.x,s.y);this.ctx.strokeStyle="green",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke();const o=Math.atan2(t.y-e.y,t.x-e.x),n=10;this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-n*Math.cos(o+Math.PI/6),t.y-n*Math.sin(o+Math.PI/6)),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-n*Math.cos(o-Math.PI/6),t.y-n*Math.sin(o-Math.PI/6)),this.ctx.stroke()}}drawStar(s,e,t,o,n,r){let l=Math.PI/2*3,a=s,h=e;const u=Math.PI/t;this.ctx.beginPath(),this.ctx.moveTo(s,e-o);for(let c=0;c<t;c++)a=s+Math.cos(l)*o,h=e+Math.sin(l)*o,this.ctx.lineTo(a,h),l+=u,a=s+Math.cos(l)*n,h=e+Math.sin(l)*n,this.ctx.lineTo(a,h),l+=u;this.ctx.closePath(),this.ctx.fillStyle=r,this.ctx.fill()}drawIteratePath(){if(d.iteratePath&&d.iteratePath.length>0){this.ctx.strokeStyle="purple",this.ctx.lineWidth=2,this.ctx.beginPath();const s=this.toCanvasCoords(d.iteratePath[0][0],d.iteratePath[0][1]);this.ctx.moveTo(s.x,s.y);for(let e=1;e<d.iteratePath.length;e++){const t=this.toCanvasCoords(d.iteratePath[e][0],d.iteratePath[e][1]);this.ctx.lineTo(t.x,t.y)}this.ctx.stroke(),d.iteratePath.forEach((e,t)=>{const o=this.toCanvasCoords(e[0],e[1]);t===d.iteratePath.length-1?this.drawStar(o.x,o.y,5,8,4,"green"):(this.ctx.beginPath(),this.ctx.fillStyle=d.highlightIteratePathIndex===t?"green":"purple",this.ctx.arc(o.x,o.y,d.highlightIteratePathIndex===t?5:3,0,2*Math.PI),this.ctx.fill())})}}draw(){this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight),this.drawGrid(),this.drawPolygon(),this.drawAnalyticCenter(),this.drawObjective(),this.drawIteratePath()}isPolygonConvex(s){if(s.length<3)return!0;let e=0;for(let t=0,o=s.length;t<o;t++){const n=s[t],r=s[(t+1)%o],l=s[(t+2)%o],a=(r.x-n.x)*(l.y-r.y)-(r.y-n.y)*(l.x-r.x);if(a!==0){if(e===0)e=a;else if(Math.sign(a)!==Math.sign(e))return!1}}return!0}}class Ps{constructor(){this.uiContainer=document.getElementById("uiContainer"),this.topTerminal=document.getElementById("terminal-container2"),this.objectiveDisplay=document.getElementById("objectiveDisplay"),this.inequalitiesDiv=document.getElementById("inequalities"),this.resultDiv=document.getElementById("result"),this.zoomButton=document.getElementById("zoomButton"),this.unzoomButton=document.getElementById("unzoomButton"),this.iteratePathButton=document.getElementById("iteratePathButton"),this.ipmButton=document.getElementById("ipmButton"),this.simplexButton=document.getElementById("simplexButton"),this.pdhgButton=document.getElementById("pdhgButton"),this.animateButton=document.getElementById("animateButton"),this.addedLandscapeWarning=!1}checkMobileOrientation(){!this.addedLandscapeWarning&&window.innerWidth<750&&window.innerHeight>window.innerWidth?(this.topTerminal.innerHTML='<div class="landscape-warning" style="display: block;">Switch to landscape mode or a larger screen.</div>'+this.topTerminal.innerHTML,this.addedLandscapeWarning=!0,this.objectiveDisplay=document.getElementById("objectiveDisplay"),this.inequalitiesDiv=document.getElementById("inequalities")):this.addedLandscapeWarning&&window.innerWidth>=750&&(this.topTerminal.removeChild(document.querySelector(".landscape-warning")),this.addedLandscapeWarning=!1,this.objectiveDisplay=document.getElementById("objectiveDisplay"),this.inequalitiesDiv=document.getElementById("inequalities"))}hideNullStateMessage(){document.getElementById("nullStateMessage").style.display="none"}updateZoomButtonsState(s){s.scaleFactor===1&&s.offset.x===0&&s.offset.y===0?this.zoomButton.disabled=!1:this.unzoomButton.disabled=!1}updateObjectiveDisplay(){if(d.objectiveVector){const s=Math.round(d.objectiveVector.x*1e3)/1e3,e=Math.round(d.objectiveVector.y*1e3)/1e3;this.objectiveDisplay.classList.add("objective-item"),this.objectiveDisplay.innerHTML=`${s}x ${e>=0?"+ "+e+"y":"- "+-e+"y"}`,this.objectiveDisplay.style.color="#eee"}else this.objectiveDisplay.classList.remove("objective-item"),this.objectiveDisplay.innerHTML=""}updateSolverModeButtons(){!d.computedLines||d.computedLines.length===0?(this.iteratePathButton.disabled=!0,this.ipmButton.disabled=!0,this.simplexButton.disabled=!0,this.pdhgButton.disabled=!0,this.animateButton.disabled=!0):(d.solverMode!=="central"&&(this.iteratePathButton.disabled=!1),d.solverMode!=="ipm"&&(this.ipmButton.disabled=!1),d.solverMode!=="simplex"&&(this.simplexButton.disabled=!1),d.solverMode!=="pdhg"&&(this.pdhgButton.disabled=!1))}updateResult(s){this.resultDiv.innerHTML=s}}const ht=i=>Array(i).fill(0),Wt=i=>Array(i).fill(1),mt=i=>i.slice(),rt=(i,s)=>i.reduce((e,t,o)=>e+t*s[o],0),wt=i=>i.reduce((s,e)=>Math.max(s,Math.abs(e)),0),bt=i=>Math.sqrt(i.reduce((s,e)=>s+e*e,0)),xt=i=>i.map(s=>Math.max(0,s)),nt=(i,s)=>i.map((e,t)=>e+s[t]),tt=(i,s)=>i.map((e,t)=>e-s[t]),ot=(i,s)=>i.map(e=>e*s),Pt=(i,s)=>i.mmul(K.columnVector(s)).to1DArray(),_t=(i,s)=>Pt(i.transpose(),s);function Gt(i){if(!i||i.length===0)return{A:new K([]),b:[]};const s=i.map(t=>t.slice(0,-1)),e=i.map(t=>t[t.length-1]);return{A:new K(s),b:e}}function ue(i,s,e,t,o){const n=Pt(i,t),r=bt(tt(n,s)),l=1+bt(s),a=r/l,h=_t(i,o),u=tt(ot(h,-1),e),c=bt(xt(u)),w=1+bt(e),v=c/w,m=rt(e,t),p=rt(s,o),S=Math.abs(m+p),f=1+Math.abs(m)+Math.abs(p),E=S/f;return a+v+E}function fe(i,s,e,t,o){const n=Pt(i,t),r=tt(n,s),l=bt(xt(r)),a=1+bt(s),h=l/a,u=bt(xt(ot(o,-1))),c=1+bt(e),w=u/c,v=rt(e,t),m=rt(s,o),p=Math.abs(m+v),S=1+Math.abs(v)+Math.abs(m),f=p/S;return h+w+f}function ge(i,s,e,t={}){const{maxit:o=1e3,eta:n=.25,tau:r=.25,tol:l=1e-4,verbose:a=!1}=t,h=i.rows,u=i.columns;let c=new Array(u).fill(0),w=new Array(h).fill(0),v=1,m=ue(i,s,e,c,w);const p=[],S=sprintf("%5s %8s %8s %10s %10s %10s","Iter","x","y"," Obj","Infeas","eps");a&&console.log(S),p.push(S);const f=[],E=performance.now();for(;v<o&&m>l;){f.push([...c]);const V=-rt(e,c);-rt(s,w);const P=Pt(i,c),B=wt(tt(P,s)),N=_t(i,w);wt(xt(tt(ot(N,-1),e)));let g=sprintf("%5d %+8.2f %+8.2f %+10.1e %+10.1e %10.1e",v,c[0]!==void 0?c[0]:0,w[0]!==void 0?-w[0]:0,V,B,m);a&&console.log(g),p.push(g);const x=nt(e,_t(i,w)),M=tt(c,ot(x,n)),j=xt(M),Y=nt(j,tt(j,c)),z=Pt(i,Y),$=tt(z,s),q=nt(w,ot($,r));c=j,w=q,v++,m=ue(i,s,e,c,w)}const T=(performance.now()-E).toFixed(2);let C;return m<=l?C=`Converged to primal-dual optimal solution in ${T}ms`:C=`Did not converge after ${f.length} iterations in ${T}ms`,a&&console.log(C),p.push(C),[f,p]}function Bs(i,s,e,t={}){const{maxit:o=1e3,eta:n=.25,tau:r=.25,tol:l=1e-4,verbose:a=!1}=t,h=i.rows,u=i.columns;let c=new Array(u).fill(0),w=new Array(h).fill(1),v=1,m=fe(i,s,e,c,w);const p=[],S=sprintf("%5s %8s %8s %10s %10s %10s","Iter","x","y"," Obj","Infeas","eps");a&&console.log(S),p.push(S);const f=[],E=performance.now();for(;v<=o&&m>l;){f.push([...c]);const V=rt(e,c);rt(s,w);const P=Pt(i,c),B=wt(xt(tt(P,s)));wt(xt(ot(w,-1)));let N=sprintf("%5d %+8.2f %+8.2f %+10.1e %+10.1e %10.1e",v,c[0]!==void 0?c[0]:0,c[1]!==void 0?c[1]:0,V,B,m);a&&console.log(N),p.push(N);const g=tt(P,s),x=nt(w,ot(g,r)),M=xt(x),j=nt(M,tt(M,w)),Y=_t(i,j),z=nt(e,Y);c=tt(c,ot(z,n)),w=M,v++,m=fe(i,s,e,c,w)}const k=performance.now(),T=parseFloat((k-E).toFixed(2));let C;return m<=l?C=`Converged to primal-dual optimal solution in ${T}ms`:C=`Did not converge after ${f.length} iterations in ${T}ms`,a&&console.log(C),p.push(C),[f,p]}function Ts(i,s,e={}){const{ineq:t=!1,maxit:o=1e3,eta:n=.25,tau:r=.25,verbose:l=!1,tol:a=1e-4,isStandardProblem:h=!1,cStandard:u=[]}=e;if(o>Math.pow(2,16))throw new Error("maxit > 2^16 not allowed");const c={maxit:o,eta:n,tau:r,verbose:l,tol:a};if(h){const f=i instanceof K?i:new K(i);return ge(f,s,u,c)}const{A:w,b:v}=Gt(i),m=s,p=w.rows,S=w.columns;if(t){const f=ot(m,-1);return Bs(w,v,f,c)}else{const f=w.to2DArray(),E=[];for(let B=0;B<p;B++){const N=new Array(2*S+p).fill(0);for(let g=0;g<S;g++)N[g]=f[B][g],N[g+S]=-f[B][g];N[B+2*S]=1,E.push(N)}const k=new K(E),T=[...ot(m,-1),...m,...new Array(p).fill(0)],[C,V]=ge(k,v,T,c);return[C.map(B=>{const N=B.slice(0,S),g=B.slice(S,2*S);return tt(N,g)}),V]}}function Cs(i){const s=i.length;if(s===0)throw new Error("No intersections found");let e=0,t=0;for(const o of i)e+=o[0],t+=o[1];return[e/s,t/s]}function Zt(i){return i===Math.floor(i)?i:parseFloat(i.toFixed(3))}function _s(i,s,e){let t=Zt(i),o=Zt(s),n=Zt(e),r="≤";t<=0&&o<=0&&n<=0&&!(t===0&&o===0&&n===0)&&(t=-t,o=-o,n=-n,r="≥");let l="";t===1?l="x":t===-1?l="-x":t!==0&&(l=`${t}x`);let a="";if(o!==0){const h=Math.abs(o),u=h===1?"y":`${h}y`;t===0?a=o<0?`-${u}`:u:a=o<0?` - ${u}`:` + ${u}`}return l===""&&a===""?`0 ${r} ${n}`:`${l}${a} ${r} ${n}`.trim()}function Rs(i,s=1e-6){const e=[],t=i.length;for(let o=0;o<t-1;o++)for(let n=o+1;n<t;n++){const[r,l,a]=i[o],[h,u,c]=i[n],w=r*u-h*l;if(Math.abs(w)<s)continue;const v=(a*u-c*l)/w,m=(r*c-h*a)/w;let p=!0;for(const S of i){const[f,E,k]=S;if(f*v+E*m>k+s){p=!1;break}}p&&e.push([parseFloat(v.toFixed(2)),parseFloat(m.toFixed(2))])}return e}function Ds(i,s=1e-6){const e=[],t=[],o=i.length;if(o<2)return{inequalities:e,lines:t};const n=Cs(i);for(let r=0;r<o;r++){const l=i[r],a=i[r===o-1?0:r+1],h=a[1]-l[1],u=-(a[0]-l[0]),c=h*l[0]+u*l[1],w=Math.sqrt(h*h+u*u);if(w<s)continue;let v=h/w,m=u/w,p=v*l[0]+m*l[1];v*n[0]+m*n[1]>p+s&&(v=-v,m=-m,p=-p),e.push(_s(h,u,c)),t.push([v,m,p])}return{inequalities:e,lines:t}}function Fs(i){if(i.length>256)throw new Error("points.length > 256 not allowed");const{inequalities:s,lines:e}=Ds(i),t=Rs(e);return{inequalities:s,vertices:t,lines:e}}function Ns(i,s,e={}){const{eps_p:t=1e-6,eps_d:o=1e-6,eps_opt:n=1e-6,maxit:r=30,alphaMax:l=.999,verbose:a=!1}=e;if(r>2**16)throw new Error("maxit > 2^16 not allowed");const{A:h,b:u}=Gt(i),c=h.to2DArray().map(m=>m.map(p=>-p)),w=u.map(m=>-m),v=s.map(m=>-m);return Ls(c,w,v,{eps_p:t,eps_d:o,eps_opt:n,maxit:r,alphaMax:l,verbose:a})}function Ls(i,s,e,t){const{eps_p:o,eps_d:n,eps_opt:r,maxit:l,alphaMax:a,verbose:h}=t,u=i.length,c=i[0].length,w=new K(i),v={iterates:{solution:{x:[],s:[],y:[],mu:[],log:[]},predictor:{x:[],s:[],y:[],mu:[]},corrector:{x:[],s:[],y:[],mu:[]}}};let m=ht(c),p=Wt(u),S=Wt(u),f=ht(c+u+u),E=ht(c+u+u),k=0,T=!1;const C=Date.now(),V=sprintf(`%5s %8s %8s %10s %10s %10s
`,"Iter","x","y","Obj","Infeas"," µ");for(h&&process.stdout.write(V),v.iterates.solution.log.push(V);k<=l;){const B=tt(s,tt(w.mmul(K.columnVector(m)).to1DArray(),p)),N=tt(e,w.transpose().mmul(K.columnVector(S)).to1DArray()),g=rt(p,S)/u,x=rt(e,m),M=Math.abs(x-rt(s,S))/(1+Math.abs(x));if(Vs(v.iterates.solution,h,m,g,x,wt(B)),Vt(v.iterates.solution,m,p,S,g),wt(B)<=o&&wt(N)<=n&&M<=r){T=!0;break}if(++k>l)break;const j=K.diag(S),Y=K.diag(p),z=K.zeros(u+c+u,c+u+u);for(let I=0;I<u;++I){for(let _=0;_<c;++_)z.set(I,_,w.get(I,_));z.set(I,c+I,-1)}for(let I=0;I<c;++I)for(let _=0;_<u;++_)z.set(u+I,c+u+_,w.get(_,I));for(let I=0;I<u;++I)z.set(u+c+I,c+I,j.get(I,I)),z.set(u+c+I,c+u+I,Y.get(I,I));const $=[].concat(B,N,p.map((I,_)=>-I*S[_]));f=kt(z,K.columnVector($)).to1DArray();const q=f.slice(0,c),J=f.slice(c,c+u),Q=f.slice(c+u),A=$t(p,J),et=$t(S,Q),st=rt(nt(p,ot(J,A)),nt(S,ot(Q,et)))/u;Vt(v.iterates.predictor,q,J,Q,st);let O,G,Z,y,b;if(A>=.9&&et>=.9)O=q,G=J,Z=Q,Vt(v.iterates.corrector,ht(c),ht(u),ht(u),g);else{const I=Math.max(1e-8,Math.min(.99999999,(st/g)**3)),_=[].concat(ht(u),ht(c),p.map((L,F)=>I*g-J[F]*Q[F]));E=kt(z,K.columnVector(_)).to1DArray(),O=nt(q,E.slice(0,c)),G=nt(J,E.slice(c,c+u)),Z=nt(Q,E.slice(c+u)),Vt(v.iterates.corrector,O,G,Z,g)}y=a*$t(p,G),b=a*$t(S,Z),m=nt(m,ot(O,y)),p=nt(p,ot(G,y)),S=nt(S,ot(Z,b))}const P=Math.round((Date.now()-C)*10)/10;return qs(v.iterates.solution,h,T,P),v}function $s(i,s){return s>=0?1:-i/s}function $t(i,s){return Math.min(1,Math.min(...i.map((e,t)=>$s(e,s[t]))))}function Vt(i,s,e,t,o){i.x.push(mt(s)),i.s.push(mt(e)),i.y.push(mt(t)),i.mu.push(o)}function Vs(i,s,e,t,o,n){const r=sprintf(`%5d %+8.2f %+8.2f %+10.1e %+10.1e %10.1e
`,i.x.length,e[0],e[1]??0,-o,n,t);s&&process.stdout.write(r),i.log.push(r)}function qs(i,s,e,t){const o=e?`Converged to primal-dual optimal solution in ${t} ms
`:`Did not converge after ${i.x.length-1} iterations in ${t} ms
`;s&&process.stdout.write(o),i.log.push(o)}function Os(i){if(!i||i.length===0)return[0,0];const s=i[0].length,e=ht(s);for(const t of i)for(let o=0;o<s;o++)e[o]+=t[o];return ot(e,1/i.length)}function zs(i,s){if(s&&i.length!==s.length)throw new Error("Length of lines and weights must match");if(!s)return{filteredLines:mt(i),filteredWeights:Wt(i.length)};const e=[],t=[];for(let o=0;o<i.length;o++)s[o]!==0&&(e.push(mt(i[o])),t.push(s[o]));return{filteredLines:e,filteredWeights:t}}function Ws(i){if(i<=0)return[];if(i===1)return[1e3];const s=[],e=3,o=(-5-e)/(i-1);for(let n=0;n<i;n++)s.push(10**(e+n*o));return s}function Ys(i,s,e,t,o,n={}){const{maxit:r=2e3,epsilon:l=1e-4,verbose:a=!1}=n;let h=mt(o);function u(c){const w=i.mmul(K.columnVector(c)).to1DArray(),v=tt(s,w);return v.some(m=>m<=0)?-1/0:rt(e,c)+t*v.reduce((m,p)=>m+Math.log(p),0)}for(let c=1;c<=r;c++){const w=i.mmul(K.columnVector(h)).to1DArray(),v=tt(s,w);if(v.some(M=>M<=0))return console.error("Infeasible point encountered at iteration "+c),null;const m=v.map(M=>1/M),p=v.map(M=>(1/M)**2),S=i.transpose().mmul(K.columnVector(m)).to1DArray(),f=tt(e,ot(S,t)),E=K.diag(p),T=i.transpose().mmul(E).mmul(i).mul(t);let C;try{C=kt(T,K.columnVector(f)).to1DArray()}catch(M){return console.error("Error solving Newton system at iteration "+c+": "+M),null}let V=1,P=0;for(;;){const M=nt(h,ot(C,V));if(tt(s,i.mmul(K.columnVector(M)).to1DArray()).every(Y=>Y>1e-12))break;if(V*=.5,V<1e-10)return console.error("Step size too small (domain) at iteration "+c),null;if(P++,P>100)return console.error("Line search (domain) stuck at iteration "+c),null}const B=.5,N=.01,g=rt(f,C),x=u(h);if(x===-1/0)return console.error("Current point x is out of domain before backtracking at iteration "+c),null;for(P=0;;){const M=nt(h,ot(C,V)),j=u(M);if(j===-1/0)V*=B;else{if(j>=x+N*V*g)break;V*=B}if(V<1e-10){a&&console.warn("Step size too small (Armijo) at iteration "+c+", using best alpha from domain search.");break}if(P++,P>100){console.error("Line search (Armijo) stuck at iteration "+c);break}}if(h=nt(h,ot(C,V)),wt(f)<l)return a&&console.log("Converged in "+c+" iterations with mu = "+t),h;if(a){const M=u(h);console.log(sprintf("Iter %d: f(x) = %.6f, ||grad||_inf = %.2e, alpha = %.2f",c,M,wt(f),V))}}return a&&console.warn("Did not converge after "+r+" iterations for mu = "+t),null}function Xs(i,s,e,t={}){const{niter:o=100,weights:n=null,verbose:r=!1}=t;if(o>2**10)throw new Error("niter > 2^10 not allowed");const l=Date.now(),{filteredLines:a,filteredWeights:h}=zs(s,n);if(a.length===0)return console.warn("No lines remaining after filtering. Returning empty path."),{centralPath:[],logs:["No lines to process after filtering."],tsolve:0};const{A:u,b:c}=Gt(a),w=new K(u),v=Ws(o),m=[],p=[];let S=sprintf(`  %-4s %8s %8s %10s %10s  
`,"Iter","x","y","Obj","µ");r&&console.log(S),p.push(S);let f=Os(i);if(e.length!==f.length){if(e.length!==w.columns)throw new Error("Objective vector dimension does not match number of variables in A.");f.length!==w.columns&&(console.warn(`Centroid dimension (${f.length}) mismatch with problem dimension (${w.columns}). Re-initializing x0.`),f=ht(w.columns))}for(const k of v){const T=Ys(w,c,e,k,f,{verbose:r,epsilon:1e-4,maxit:2e3});if(T!==null&&T.length>0){m.push(mt(T));const C=T[0]!==void 0?T[0]:0,V=T[1]!==void 0?T[1]:0;S=sprintf(`  %-4d %+8.2f %+8.2f %+10.1e %10.1e  
`,m.length,C,V,rt(e,T),k),r&&console.log(S),p.push(S),f=T}else r&&console.log(`Failed to find x_k for mu = ${k}. Skipping.`)}const E=(Date.now()-l)/1e3;return{central_path:m,logs:p,tsolve:E}}function de(...i){if(i.length===0)return new K([]);const s=i[0].rows;if(!i.every(n=>n.rows===s))throw new Error("hstack: all blocks must have identical row-count");const e=i.reduce((n,r)=>n+r.columns,0),t=K.zeros(s,e);let o=0;for(const n of i){if(n.columns>0)for(let r=0;r<n.rows;++r)for(let l=0;l<n.columns;++l)t.set(r,o+l,n.get(r,l));o+=n.columns}return t}function As(i,s,e={}){const{tol:t=1e-6,verbose:o=!1}=e,{A:n,b:r}=Gt(i),l=n.rows,a=n.columns,h=s.slice(),u=r.map($=>$<0?-1:1),c=K.diag(u),w=r.map(($,q)=>u[q]*$);c.to2DArray().map(($,q)=>n.to2DArray()[0].map((J,Q)=>$.reduce((A,et,st)=>A+et*n.get(st,Q),0)));const v=c.mmul(n),m=v.to2DArray().map($=>$.map(q=>-q)),p=new K(m),S=K.eye(l),f=de(v,p,c.mmul(S),S),E=[].concat(ht(2*a+l),Wt(l).map($=>-1)),k=Array(2*a+2*l).fill(!1);for(let $=0;$<l;++$)k[2*a+l+$]=!0;o&&console.log("Phase One");const[T,C,V]=me(E,f,w,k,{tol:t,verbose:o,phase1:!0,nOrig:a,m:l}),P=[].concat(h,h.map($=>-$),ht(l)),B=n.to2DArray().map($=>$.map(q=>-q)),N=new K(B),g=de(n,N,S);o&&console.log("Phase Two");const[x,M,j]=me(P,g,r,C,{tol:t,verbose:o,phase1:!1,nOrig:a,m:l});return[T.slice(0,-1).concat(x).map($=>{const q=$.slice(0,a),J=$.slice(a,2*a);return tt(q,J)}),[V,j]]}function me(i,s,e,t,o){const{tol:n,verbose:r,phase1:l,nOrig:a,m:h}=o,u=s.rows,c=s.columns;if(u!==h||e.length!==h)throw new Error(`Dimension mismatch: A.rows=${u} vs m=${h}, bVec.length=${e.length} vs m=${h}`);let w=mt(t);const v=[],m=[],p="basis",S=" ".repeat(Math.max(0,c-p.length)),f=p+S,E=sprintf(`%5s %8s %8s %10s %s
`,"Iter","x","y","Obj",f);r&&console.log(E),m.push(E);let k=0;const T=65536;for(;;){if(++k>T)throw new Error(`Simplex stalled after ${T} iterations`);const P=[];for(let y=0;y<c;++y)w[y]&&P.push(y);if(P.length!==u)throw new Error(`Basis size ${P.length} does not match number of constraints ${u}. Basis: ${w.map(y=>y?1:0).join("")}`);const B=K.zeros(u,u);for(let y=0;y<u;++y){const b=P[y];for(let I=0;I<u;++I)B.set(I,y,s.get(I,b))}let N;try{N=kt(B,K.columnVector(e)).to1DArray()}catch(y){throw console.error("Error solving BxB = b. B might be singular.",y),console.error("B:",B.to2DArray()),console.error("bVec:",e),console.error("Basis Indices:",P),console.error("Basis bool array:",w.map(b=>b?1:0).join("")),y}const g=ht(c);P.forEach((y,b)=>{g[y]=N[b]}),v.push(mt(g));const x=P.map(y=>i[y]),M=kt(B.transpose(),K.columnVector(x)).to1DArray(),j=_t(s,M),Y=i.map((y,b)=>y-j[b]),z=rt(i,g),$=g[0]!==void 0?g[0]:0,q=M[0]!==void 0?M[0]:0,J=sprintf(`%5d %+8.2f %+8.2f %+10.1e %s
`,k,$,q,z,w.map(y=>y?1:0).join(""));r&&console.log(J),m.push(J);let Q=-1,A=n;for(let y=0;y<c;++y)!w[y]&&Y[y]>A&&(A=Y[y],Q=y);if(Q===-1)break;const et=Array.from({length:u},(y,b)=>s.get(b,Q)),st=kt(B,K.columnVector(et)).to1DArray();let O=-1,G=1/0;for(let y=0;y<u;++y)if(st[y]>n){const b=N[y]/st[y];b<G-n&&(G=b,O=y)}if(O===-1){const y="LP is unbounded. No leaving variable found.";throw r&&console.log(y),m.push(y),new Error(y)}const Z=P[O];w[Q]=!0,w[Z]=!1}let C=mt(w);if(l){const P=2*a+h;let B=!1;for(let g=0;g<h;++g){const x=P+g;if(C[x]){const M=basisIndices.indexOf(x);if(M!==-1&&x_tableau[x]>n){B=!0;break}else if(M===-1&&x_tableau[x]>n){B=!0;break}}}if(B){const g="Problem infeasible (Phase-1 optimum > 0, an artificial variable is basic with positive value)";if(r&&console.log(g),m.push(g),Math.abs(objVal)>n)throw new Error(g)}C=C.slice(0,2*a+h);let N=C.filter(g=>g).length;if(N<h)for(let g=2*a;g<2*a+h&&N<h;++g)C[g]||(C[g]=!0,N++);if(C.filter(g=>g).length!==h){const g=`Phase 1 resulted in a basis for Phase 2 of size ${C.filter(x=>x).length}, expected ${h}.`;r&&console.warn(g),m.push(g)}}const V=sprintf(`Phase %d finished – basis %s
`,l?1:2,C.map(P=>P?1:0).join(""));return r&&console.log(V),m.push(V),[v,C,m]}async function Us(i){try{const s=Fs(i);return Promise.resolve(s)}catch(s){return console.error("Error in local Polytope solver:",s),Promise.reject(s)}}async function Gs(i,s,e,t,o){try{const r=Xs(i,s,e,{niter:o,weights:t,verbose:!1});return Promise.resolve(r)}catch(n){return console.error("Error in local Central Path solver:",n),Promise.reject(n)}}async function Js(i,s){try{const e=await As(i,s,{});return Promise.resolve(e)}catch(e){return console.error("Error in local Simplex solver:",e),Promise.reject(e)}}async function Ks(i,s,e,t,o){try{const r=Ns(i,s,{alphaMax:t,maxit:o,verbose:!1});return Promise.resolve(r)}catch(n){return console.error("Error in local IPM solver:",n),Promise.reject(n)}}async function Qs(i,s,e,t,o,n){try{const l=Ts(i,s,{ineq:e,maxit:t,eta:o,tau:n,verbose:!1});return Promise.resolve(l)}catch(r){return console.error("Error in local PDHG solver:",r),Promise.reject(r)}}function Zs(i,s){const e=i.canvas,t=(y,b)=>Math.hypot(y.x-b.x,y.y-b.y),o=y=>({x:y.reduce((b,I)=>b+I.x,0)/y.length,y:y.reduce((b,I)=>b+I.y,0)/y.length}),n=y=>{if(y.length<3)return!0;let b=0;for(let I=0,_=y.length;I<_;I++){const L=y[I],F=y[(I+1)%_],D=y[(I+2)%_],X=(F.x-L.x)*(D.y-F.y)-(F.y-L.y)*(D.x-F.x);if(X!==0){if(b===0)b=X;else if(Math.sign(X)!==Math.sign(b))return!1}}return!0},r=(y,b)=>{let I=!1;for(let _=0,L=b.length-1;_<b.length;L=_++){const F=b[_].x,D=b[_].y,X=b[L].x,H=b[L].y;D>y.y!=H>y.y&&y.x<(X-F)*(y.y-D)/(H-D)+F&&(I=!I)}return I},l=(y,b,I)=>{const _=I.x-b.x,L=I.y-b.y,F=_*_+L*L,D=((y.x-b.x)*_+(y.y-b.y)*L)/F;if(D<0||D>1)return!1;const X={x:b.x+D*_,y:b.y+D*L};return Math.hypot(y.x-X.x,y.y-X.y)<.5};e.addEventListener("mousedown",y=>{const b=e.getBoundingClientRect(),I=y.clientX-b.left,_=y.clientY-b.top,L=i.toLogicalCoords(I,_);if(d.polygonComplete){if(d.objectiveVector!==null){const D=i.toCanvasCoords(d.objectiveVector.x,d.objectiveVector.y);if(Math.hypot(I-D.x,_-D.y)<10){d.draggingObjective=!0;return}}const F=d.vertices.findIndex(D=>t(L,D)<.5);if(F!==-1){d.draggingPointIndex=F;return}d.isPanning=!0,d.lastPan={x:y.clientX,y:y.clientY}}else{const F=d.vertices.findIndex(D=>t(L,D)<.5);F!==-1&&(d.draggingPointIndex=F);return}}),e.addEventListener("mousemove",y=>{if(d.draggingPointIndex!==null){d.vertices[d.draggingPointIndex]=i.toLogicalCoords(y.clientX-e.getBoundingClientRect().left,y.clientY-e.getBoundingClientRect().top),i.draw();return}if(d.draggingObjective){d.objectiveVector=i.toLogicalCoords(y.clientX-e.getBoundingClientRect().left,y.clientY-e.getBoundingClientRect().top),s.updateObjectiveDisplay(),i.draw();return}if(d.isPanning){const L=y.clientX-d.lastPan.x,F=y.clientY-d.lastPan.y;i.offset.x+=L/(i.gridSpacing*i.scaleFactor),i.offset.y-=F/(i.gridSpacing*i.scaleFactor),d.lastPan={x:y.clientX,y:y.clientY},i.draw(),document.getElementById("unzoomButton").disabled=!1;return}const b=e.getBoundingClientRect(),I=y.clientX-b.left,_=y.clientY-b.top;d.polygonComplete?d.polygonComplete&&d.objectiveVector===null&&(d.currentObjective=i.toLogicalCoords(I,_),i.draw()):(d.currentMouse=i.toLogicalCoords(I,_),i.draw())}),e.addEventListener("mouseup",()=>{if(d.isPanning){d.isPanning=!1,d.wasPanning=!0;return}d.draggingPointIndex!==null&&(d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.draggingPointIndex=null,G()),d.draggingObjective&&(d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.draggingObjective=!1,G())}),e.addEventListener("dblclick",y=>{const b=e.getBoundingClientRect(),I=y.clientX-b.left,_=y.clientY-b.top,L=i.toLogicalCoords(I,_);for(let F=0;F<d.vertices.length;F++){const D=d.vertices[F],X=d.vertices[(F+1)%d.vertices.length];if(l(L,D,X)){const H=X.x-D.x,vt=X.y-D.y,dt=Math.hypot(H,vt),ct={x:-vt/dt,y:H/dt},Tt={x:L.x-ct.x*.1,y:L.y-ct.y*.1};d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.vertices.splice(F+1,0,Tt),i.draw(),G();break}}}),e.addEventListener("click",y=>{d.wasPanning&&(d.wasPanning=!1);const b=e.getBoundingClientRect(),I=i.toLogicalCoords(y.clientX-b.left,y.clientY-b.top);if(d.polygonComplete)d.polygonComplete&&d.objectiveVector===null&&(d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.objectiveVector=d.currentObjective||I,document.getElementById("maximize").style.display="block",document.getElementById("ipmButton").disabled=!1,document.getElementById("simplexButton").disabled=!1,document.getElementById("pdhgButton").disabled=!1,document.getElementById("iteratePathButton").disabled=!0,document.getElementById("traceButton").disabled=!1,document.getElementById("animateButton").disabled=!1,document.getElementById("startRotateObjectiveButton").disabled=!1,document.getElementById("zoomButton").disabled=!1,s.updateObjectiveDisplay(),i.draw());else{if(d.vertices.length>=3){if(t(I,d.vertices[0])<.5){d.polygonComplete=!0,d.interiorPoint=o(d.vertices),i.draw(),G();return}if(r(I,d.vertices)){d.polygonComplete=!0,d.interiorPoint=I,i.draw(),G();return}}const _=[...d.vertices,I];if(_.length>=3&&!n(_)){alert("Adding this vertex would make the polygon nonconvex. Please choose another point.");return}d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.vertices.push(I),s.hideNullStateMessage(),i.draw(),G()}}),window.addEventListener("keydown",y=>{if((y.metaKey||y.ctrlKey)&&y.key.toLowerCase()==="z"){if(y.preventDefault(),y.shiftKey){if(d.redoStack.length){const b=d.redoStack.pop();d.historyStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.vertices=b.vertices,d.objectiveVector=b.objectiveVector,i.draw(),G()}}else if(d.historyStack.length){const b=d.historyStack.pop();d.redoStack.push({vertices:JSON.parse(JSON.stringify(d.vertices)),objectiveVector:d.objectiveVector?{...d.objectiveVector}:null}),d.vertices=b.vertices,d.objectiveVector=b.objectiveVector,i.draw(),G()}}y.key.toLowerCase()==="s"&&(d.snapToGrid=!d.snapToGrid)}),window.addEventListener("load",()=>{document.getElementById("gridCanvas").focus()}),s.zoomButton.addEventListener("click",()=>{if(d.vertices.length>0){let y=1/0,b=-1/0,I=1/0,_=-1/0;d.vertices.forEach(ct=>{ct.x<y&&(y=ct.x),ct.x>b&&(b=ct.x),ct.y<I&&(I=ct.y),ct.y>_&&(_=ct.y)});const L=b-y,F=_-I,D={x:(y+b)/2,y:(I+_)/2};i.offset.x=-D.x,i.offset.y=-D.y;const X=50,H=document.getElementById("sidebar").offsetWidth,vt=window.innerWidth-H-2*X,dt=window.innerHeight-2*X;L>0&&F>0&&(i.scaleFactor=Math.min(vt/(L*i.gridSpacing),dt/(F*i.gridSpacing))),i.centerX=H+(window.innerWidth-H)/2,i.centerY=window.innerHeight/2,i.draw(),s.updateZoomButtonsState(i)}}),s.unzoomButton.addEventListener("click",()=>{i.scaleFactor=1,i.offset.x=0,i.offset.y=0,i.draw(),s.updateZoomButtonsState(i)});const a=document.getElementById("iteratePathButton"),h=document.getElementById("ipmButton"),u=document.getElementById("simplexButton"),c=document.getElementById("pdhgButton");a.addEventListener("click",()=>{d.solverMode="central",a.disabled=!0,h.disabled=!1,u.disabled=!1,c.disabled=!1,document.getElementById("ipmSettings").style.display="none",document.getElementById("pdhgSettings").style.display="none",document.getElementById("centralPathSettings").style.display="block"}),h.addEventListener("click",()=>{d.solverMode="ipm",h.disabled=!0,a.disabled=!1,u.disabled=!1,c.disabled=!1,document.getElementById("ipmSettings").style.display="block",document.getElementById("pdhgSettings").style.display="none",document.getElementById("centralPathSettings").style.display="none"}),u.addEventListener("click",()=>{d.solverMode="simplex",u.disabled=!0,h.disabled=!1,a.disabled=!1,c.disabled=!1,document.getElementById("ipmSettings").style.display="none",document.getElementById("pdhgSettings").style.display="none",document.getElementById("centralPathSettings").style.display="none"}),c.addEventListener("click",()=>{d.solverMode="pdhg",c.disabled=!0,u.disabled=!1,h.disabled=!1,a.disabled=!1,document.getElementById("ipmSettings").style.display="none",document.getElementById("pdhgSettings").style.display="block",document.getElementById("centralPathSettings").style.display="none"});const w=document.getElementById("alphaMaxSlider"),v=document.getElementById("pdhgEtaSlider"),m=document.getElementById("pdhgTauSlider"),p=document.getElementById("maxitInput"),S=document.getElementById("maxitInputPDHG"),f=document.getElementById("pdhgIneqMode"),E=document.getElementById("objectiveAngleStepSlider"),k=document.getElementById("objectiveAngleStepValue"),T=document.getElementById("centralPathIterSlider"),C=document.getElementById("centralPathIterValue");w.addEventListener("input",()=>{document.getElementById("alphaMaxValue").textContent=parseFloat(w.value).toFixed(3),d.solverMode==="ipm"&&A()}),v.addEventListener("input",()=>{document.getElementById("pdhgEtaValue").textContent=parseFloat(v.value).toFixed(3),d.solverMode==="pdhg"&&A()}),m.addEventListener("input",()=>{document.getElementById("pdhgTauValue").textContent=parseFloat(m.value).toFixed(3),d.solverMode==="pdhg"&&A()}),p.addEventListener("input",()=>{d.solverMode==="ipm"&&A()}),S.addEventListener("input",()=>{d.solverMode==="pdhg"&&A()}),f.addEventListener("change",()=>{d.solverMode==="pdhg"&&A()}),E.addEventListener("input",()=>{k.textContent=parseFloat(E.value).toFixed(2)}),T.addEventListener("input",()=>{C.textContent=T.value,d.solverMode==="central"&&A()}),document.getElementById("traceButton").addEventListener("click",()=>{A(),d.iteratePathComputed=!0});const P=document.getElementById("startRotateObjectiveButton"),B=document.getElementById("stopRotateObjectiveButton"),N=document.getElementById("objectiveRotationSettings");P.addEventListener("click",()=>{d.rotateObjectiveMode=!0,d.objectiveVector||(d.objectiveVector={x:1,y:0},s.updateObjectiveDisplay()),d.animationIntervalId!==null&&(clearInterval(d.animationIntervalId),d.animationIntervalId=null),N.style.display="block",P.disabled=!0,B.disabled=!1,Z()}),B.addEventListener("click",()=>{d.rotateObjectiveMode=!1,N.style.display="none",P.disabled=!1,B.disabled=!0});const g=document.getElementById("animateButton"),x=document.getElementById("replaySpeedSlider");g.addEventListener("click",()=>{if(d.rotateObjectiveMode)return;d.animationIntervalId!==null&&(clearInterval(d.animationIntervalId),d.animationIntervalId=null);const y=parseInt(x.value,10)||500,b=[...d.originalIteratePath];d.iteratePath=[],d.highlightIteratePathIndex=null,i.draw();let I=0;d.animationIntervalId=setInterval(()=>{if(I>=b.length){clearInterval(d.animationIntervalId),d.animationIntervalId=null;return}d.iteratePath.push(b[I]),d.highlightIteratePathIndex=I,I++,i.draw()},y)});const M=document.getElementById("sidebar"),j=document.getElementById("sidebarHandle");let Y=!1;j.addEventListener("mousedown",y=>{Y=!0,y.preventDefault()}),document.addEventListener("mousemove",y=>{if(!Y)return;let b=y.clientX;b=Math.max(200,Math.min(b,1e3)),M.style.width=`${b}px`,j.style.left=`${b}px`,i.centerX=b+(window.innerWidth-b)/2,i.draw()}),document.addEventListener("mouseup",()=>{Y&&(Y=!1,st())});let z=0,$=0,q=null;const J=document.getElementById("result");document.addEventListener("mousemove",y=>{z=y.clientX,$=y.clientY,Q()});function Q(){const y=document.elementFromPoint(z,$);y&&y.classList.contains("central-path-item")?q!==y&&(q&&(q.classList.remove("hover"),q.dispatchEvent(new Event("mouseleave",{bubbles:!0}))),y.classList.add("hover"),y.dispatchEvent(new Event("mouseenter",{bubbles:!0})),q=y):q&&(q.classList.remove("hover"),q.dispatchEvent(new Event("mouseleave",{bubbles:!0})),q=null)}J.addEventListener("scroll",Q);async function A(){if(g.disabled=!1,d.animationIntervalId!==null&&(clearInterval(d.animationIntervalId),d.animationIntervalId=null),d.solverMode==="ipm"){const y=parseFloat(w.value),b=parseInt(p.value,10),_=(await Ks(d.computedLines,[d.objectiveVector.x,d.objectiveVector.y],et(),y,b)).iterates.solution,L=_.log,F=_.x.map((X,H)=>_.x[H]);d.originalIteratePath=[...F],d.iteratePath=F;let D="";D+=`<div class="central-path-header">${L[0]}</div>`;for(let X=1;X<L.length-1;X++)D+=`<div class="central-path-item" data-index="${X-1}">${L[X]}</div>`;L.length>1&&(D+=`<div class="central-path-footer">${L[L.length-1]}</div>`),O(D)}else if(d.solverMode==="simplex"){const y=await Js(d.computedLines,[d.objectiveVector.x,d.objectiveVector.y]),b=y[0].map(F=>F),I=y[1][0],_=y[1][1];d.originalIteratePath=[...b],d.iteratePath=b;let L="";L+=`<div class="central-path-header">Phase 1
${I[0]}</div>`;for(let F=1;F<I.length-1;F++)L+=`<div class="central-path-item" data-index="${F-1}">${I[F]}</div>`;L+=`<div class="central-path-footer">${I[I.length-1]}</div>`,L+=`<div class="central-path-header">Phase 2
${_[0]}</div>`;for(let F=1;F<_.length-1;F++)L+=`<div class="central-path-item" data-index="${F+I.length-4}">${_[F]}</div>`;L+=`<div class="central-path-footer">${_[_.length-1]}</div>`,O(L)}else if(d.solverMode==="pdhg"){const y=parseInt(S.value,10),b=document.getElementById("pdhgIneqMode").checked,I=parseFloat(v.value),_=parseFloat(m.value),L=await Qs(d.computedLines,[d.objectiveVector.x,d.objectiveVector.y],b,y,I,_),F=L[0].map(H=>H),D=L[1];d.originalIteratePath=[...F],d.iteratePath=F;let X="";X+=`<div class="central-path-header">${D[0]}</div>`;for(let H=1;H<D.length-1;H++)X+=`<div class="central-path-item" data-index="${H-1}">${D[H]}</div>`;D.length>1&&(X+=`<div class="central-path-footer">${D[D.length-1]}</div>`),O(X)}else{const y=et(),b=parseInt(T.value,10),I=await Gs(d.computedVertices,d.computedLines,[d.objectiveVector.x,d.objectiveVector.y],y,b),_=I.central_path.map(X=>X),L=I.logs,F=I.tsolve;d.originalIteratePath=[..._],d.iteratePath=_;let D="";D+=`<div class="central-path-header">${L[0]}</div>`;for(let X=1;X<L.length;X++)D+=`<div class="central-path-item" data-index="${X-1}">${L[X]}</div>`;L.length>1&&(D+=`<div class="central-path-footer">Traced central path in ${Math.round(F*1e3)}ms</div>`),O(D)}}function et(){const y=document.querySelectorAll(".inequality-item");let b=[];return y.forEach(I=>{const _=I.querySelector("input");b.push(_?parseFloat(_.value):1)}),b}function st(){const y=document.getElementById("result");if(!y||y.querySelector("#usageTips"))return;const b=window.getComputedStyle(y),I=parseFloat(b.paddingLeft)||0,_=parseFloat(b.paddingRight)||0,L=y.clientWidth-I-_,F=y.querySelectorAll("div");if(F.length===0)return;const D=document.createElement("div");D.style.position="absolute",D.style.visibility="hidden",D.style.fontFamily=b.fontFamily,D.style.fontWeight=b.fontWeight,D.style.fontStyle=b.fontStyle,D.style.whiteSpace="pre-wrap",document.body.appendChild(D);const X=18;let H=1/0;F.forEach(dt=>{D.style.fontSize=`${X}px`,D.textContent=dt.textContent;const ct=D.getBoundingClientRect().width,Tt=(L-10)/ct;Tt<H&&Tt<4&&(H=Tt)});const vt=Math.min(24,X*H*.875);F.forEach(dt=>{dt.style.fontSize=`${vt}px`}),document.body.removeChild(D)}function O(y){J.innerHTML=y,document.querySelectorAll(".central-path-header, .central-path-item, .central-path-footer").forEach(b=>{b.addEventListener("mouseenter",()=>{d.highlightIteratePathIndex=parseInt(b.getAttribute("data-index")),i.draw()}),b.addEventListener("mouseleave",()=>{d.highlightIteratePathIndex=null,i.draw()})}),i.draw(),st()}async function G(){const y=d.vertices.map(b=>[b.x,b.y]);try{const b=await Us(y);if(b.inequalities){if(!n(d.vertices)){s.inequalitiesDiv.innerHTML="Nonconvex";return}s.inequalitiesDiv.innerHTML=b.inequalities.slice(0,d.polygonComplete?b.inequalities.length:b.inequalities.length-1).map((I,_)=>`
            <div class="inequality-item" data-index="${_}">
              ${I}<br>
              <span class="barrier-weight-container" style="display: ${d.barrierWeightsVisible?"inline":"none"};">
                <span style="font-family: sans-serif;">Barrier weight:</span>
                <input type="number" id="weight-${_}" value="${d.barrierWeights[_]!==void 0?d.barrierWeights[_]:1}" step="any" autocomplete="off" style="width:60px" />
              </span>
            </div>
          `).join(""),document.querySelectorAll(".inequality-item").forEach(I=>{I.addEventListener("mouseenter",()=>{d.highlightIndex=parseInt(I.getAttribute("data-index")),i.draw()}),I.addEventListener("mouseleave",()=>{d.highlightIndex=null,i.draw()}),I.querySelectorAll('input[type="number"]').forEach(_=>{_.addEventListener("change",()=>{const L=parseInt(_.id.split("-")[1]);d.barrierWeights[L]=parseFloat(_.value)})})}),b.lines.length>0&&(document.getElementById("subjectTo").style.display="block"),d.computedVertices=b.vertices,d.computedLines=b.lines,s.updateSolverModeButtons(),d.iteratePathComputed&&d.objectiveVector&&d.computedLines.length>0&&A()}else s.inequalitiesDiv.textContent="No inequalities returned."}catch(b){console.error("Error:",b),s.inequalitiesDiv.textContent="Error computing inequalities."}}function Z(){if(!n(d.vertices)){setTimeout(Z,30);return}if(!d.rotateObjectiveMode)return;const b=Math.atan2(d.objectiveVector.y,d.objectiveVector.x),I=Math.hypot(d.objectiveVector.x,d.objectiveVector.y),_=parseFloat(E.value);d.objectiveVector={x:I*Math.cos(b+_),y:I*Math.sin(b+_)},s.updateObjectiveDisplay(),i.draw(),d.polygonComplete&&d.computedLines&&d.computedLines.length>0?A().then(()=>{d.rotateObjectiveMode&&setTimeout(Z,30)}):d.rotateObjectiveMode&&setTimeout(Z,30)}e.addEventListener("wheel",y=>{y.preventDefault();const b=e.getBoundingClientRect(),I=y.clientX-b.left,_=y.clientY-b.top,L=i.scaleFactor,F=1.05;let D=L;y.deltaY<0?D=L*F:D=L/F,D=Math.min(100,Math.max(.1,D));const X=i.toLogicalCoords(I,_);i.scaleFactor=D,i.offset.x=(I-i.centerX)/(i.gridSpacing*D)-X.x,i.offset.y=(i.centerY-_)/(i.gridSpacing*D)-X.y,i.draw()})}const Hs=document.getElementById("gridCanvas"),zt=new ks(Hs),ee=new Ps;function Ie(){ee.checkMobileOrientation(),zt.updateDimensions(),zt.draw(),ee.updateZoomButtonsState(zt)}window.addEventListener("resize",Ie);Ie();Zs(zt,ee);
